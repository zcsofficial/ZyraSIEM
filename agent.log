2025-03-02 15:46:22,814 - INFO - Elevating to Administrator privileges...
2025-03-02 15:46:25,980 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Starting topology monitoring"}
2025-03-02 15:46:25,981 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>]>", "message": "Topology description changed"}
2025-03-02 15:46:25,981 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "message": "Starting server monitoring"}
2025-03-02 15:46:25,981 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "message": "Starting server monitoring"}
2025-03-02 15:46:25,981 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "message": "Starting server monitoring"}
2025-03-02 15:46:25,981 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool created", "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:25,982 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool created", "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:25,983 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool created", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:25,985 - INFO - Connected to MongoDB successfully
2025-03-02 15:46:25,986 - INFO - Local SQLite database initialized
2025-03-02 15:46:25,987 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:46:26,388 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "message": "Server heartbeat started"}
2025-03-02 15:46:26,389 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "message": "Server heartbeat started"}
2025-03-02 15:46:26,395 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "message": "Server heartbeat started"}
2025-03-02 15:46:26,471 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 82.35319994855672, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910586, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910586, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:26,473 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 82.86570000927895, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"ismaster\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910586, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910586, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMe...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:26,476 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 80.16679994761944, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910586, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910586, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:26,477 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool ready", "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:26,479 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>]>", "message": "Topology description changed"}
2025-03-02 15:46:26,479 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool ready", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:26,480 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "message": "Topology description changed"}
2025-03-02 15:46:26,480 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:26,480 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool ready", "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:26,480 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "message": "Topology description changed"}
2025-03-02 15:46:26,481 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:26,481 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:28,052 - ERROR - Error fetching VT API key: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /get_vt_api_key (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3330E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D3330E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /get_vt_api_key (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3330E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 118, in fetch_vt_api_key
    response = requests.get(VT_API_KEY_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /get_vt_api_key (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3330E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:46:28,052 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:28,052 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,052 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,052 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection created", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:28,805 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection ready", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.5123971001012251}
2025-03-02 15:46:28,806 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.7532797999447212}
2025-03-02 15:46:28,806 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910586, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"geMVVM90LL3vBlO8BJTtn88+Teg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 26500, "operationId": 26500, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,885 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 78.936, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 26500, "operationId": 26500, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,885 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:28,885 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:28,885 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,885 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,885 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.1299924962222576e-05}
2025-03-02 15:46:28,885 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"find\": \"device_info\", \"filter\": {\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\"}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910586, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"geMVVM90LL3vBlO8BJTtn88+Teg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\"}", "commandName": "find", "databaseName": "zyra_siem", "requestId": 19169, "operationId": 19169, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,977 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 91.183, "reply": "{\"cursor\": {\"firstBatch\": [{\"_id\": {\"$oid\": \"67c41eb2df09a753e9d4abf7\"}, \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\", \"os\": \"Windows 11\", \"first_seen\": \"2025-03-02T14:32:40.929861\", \"last_updated\": \"2025-03-02T15:45:20.037934\"}], \"ns\": \"zyra_siem.device_info\"}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910588, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TMXt/23BvoL0s0d7xNu9mAoLFP0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910588, \"i\": 2}}}", "commandName": "find", "databaseName": "zyra_siem", "requestId": 19169, "operationId": 19169, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,977 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:28,977 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "update", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:28,977 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "update", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,977 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:28,977 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 4.840001929551363e-05}
2025-03-02 15:46:28,977 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"update\": \"device_info\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 1, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910588, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TMXt/23BvoL0s0d7xNu9mAoLFP0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"updates\": [{\"q\": {\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\"}, \"u\": {\"$set\": {\"last_updated\": \"2025-03-02T15:46:28.977508\"}}}]}", "commandName": "update", "databaseName": "zyra_siem", "requestId": 15724, "operationId": 15724, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,056 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 78.381, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910589, \"i\": 1}}, \"t\": 85}, \"nModified\": 1, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910589, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"+W9Mv/S2LIhAx0omSZ3bm60zxBc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910589, \"i\": 1}}}", "commandName": "update", "databaseName": "zyra_siem", "requestId": 15724, "operationId": 15724, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,056 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:29,109 - INFO - Processes monitored with VirusTotal
2025-03-02 15:46:29,110 - INFO - System logs collected
2025-03-02 15:46:29,110 - INFO - Registry change detected: SOFTWARE\Microsoft\Windows\CurrentVersion\Run
2025-03-02 15:46:29,110 - INFO - Security logs collected
2025-03-02 15:46:29,111 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:29,111 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,112 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,112 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:46:29,112 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0005079999100416899}
2025-03-02 15:46:29,113 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910589, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"+W9Mv/S2LIhAx0omSZ3bm60zxBc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 41, "operationId": 41, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,319 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 206.79500000000002, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 41, "operationId": 41, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,320 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:29,320 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:29,320 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,320 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,320 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 4.980002995580435e-05}
2025-03-02 15:46:29,320 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 2, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910589, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"+W9Mv/S2LIhAx0omSZ3bm60zxBc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:46:29.070160\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"memory_percent\": 0.12173595027986156, \"timestamp\": \"2025-03-02T15:46:29.070612\"}, {\"pid\": 140, \"username\": \"NT AUTHORITY\\SYSTEM\", \"memory_percent\": 0.0006313853395723918, \"timestamp\": \"2025-03-02T15:46:29.071017\"}, {\"pid\": 188, \"name\": \"Registry\", \"username\": ...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18467, "operationId": 18467, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,871 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 551.1859999999999, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910590, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910590, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"W0qF3H89qQ5OeUCE9LzFHaYmzSI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910590, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18467, "operationId": 18467, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:29,872 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:29,872 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:46:29,875 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:46:30,061 - INFO - System metrics collected
2025-03-02 15:46:31,189 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D40E0D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D40E0D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D40E0D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D40E0D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:46:34,152 - INFO - Processes monitored with VirusTotal
2025-03-02 15:46:34,152 - INFO - System logs collected
2025-03-02 15:46:34,152 - INFO - Security logs collected
2025-03-02 15:46:34,876 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:34,877 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:34,878 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:34,878 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0004513000603765249}
2025-03-02 15:46:34,878 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910590, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"W0qF3H89qQ5OeUCE9LzFHaYmzSI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 6334, "operationId": 6334, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:34,973 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 94.88000000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 6334, "operationId": 6334, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:34,973 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:34,974 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:34,974 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:34,974 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:34,974 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.079992115497589e-05}
2025-03-02 15:46:34,974 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 3, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910590, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"W0qF3H89qQ5OeUCE9LzFHaYmzSI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.9, \"memory_percent\": 63.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:46:30.061863\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1192.6, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:46:34.119456\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"memory_percent\": 0.12173595027986156, \"t...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 26500, "operationId": 26500, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:35,213 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 239.35899999999998, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910595, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910595, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Ua1/xRQv+x9j3RGeYqX22ZnEmpY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910595, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 26500, "operationId": 26500, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:35,214 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:35,214 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:46:35,214 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -677510773, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:35,214 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -677510773, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08016679994761944>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08235319994855672>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.08286570000927895>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:35,214 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:35,214 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.419994704425335e-05}
2025-03-02 15:46:35,214 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 4, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910595, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Ua1/xRQv+x9j3RGeYqX22ZnEmpY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:46:34.876251\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43003e0003d68174affa3\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19169, "operationId": 19169, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:35,297 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 82.36699999999999, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910595, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910595, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Ua1/xRQv+x9j3RGeYqX22ZnEmpY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910595, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19169, "operationId": 19169, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:35,297 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:35,297 - INFO - 1 alerts stored
2025-03-02 15:46:35,299 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:46:36,073 - INFO - System metrics collected
2025-03-02 15:46:36,190 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:46:36,735 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10254.145800019614, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910596, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910596, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:36,737 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10256.8410000531, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910596, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910596, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:36,738 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:36,739 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:36,740 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10259.044299949892, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910596, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910596, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:36,742 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:38,258 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D40F250>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D40F250>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D40F250>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D40F250>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:46:39,197 - INFO - Processes monitored with VirusTotal
2025-03-02 15:46:39,197 - INFO - System logs collected
2025-03-02 15:46:39,197 - INFO - Security logs collected
2025-03-02 15:46:40,300 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:40,301 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,301 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,301 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00039850000757724047}
2025-03-02 15:46:40,302 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910596, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"G/Go5CtR9HsMYSrRlonFfJfq5qc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 15724, "operationId": 15724, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,417 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 114.914, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 15724, "operationId": 15724, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,417 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:40,417 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:40,417 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,417 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,417 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.91999851167202e-05}
2025-03-02 15:46:40,418 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 5, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910596, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"G/Go5CtR9HsMYSrRlonFfJfq5qc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.4, \"memory_percent\": 63.3, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:46:36.073134\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1192.8, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:46:39.163857\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1.9, \"memory_percent\": 0.1...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11478, "operationId": 11478, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,718 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 300.788, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910600, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910600, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"MR3gOdPwZzoQ7KxM3IpYJ+dkpOg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910600, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11478, "operationId": 11478, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,719 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:40,719 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:46:40,719 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -246867380, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:40,719 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -246867380, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,719 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,719 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.139992572367191e-05}
2025-03-02 15:46:40,720 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 6, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910600, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"MR3gOdPwZzoQ7KxM3IpYJ+dkpOg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:46:40.299849\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43008e0003d68174affa5\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 29358, "operationId": 29358, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,843 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 123.45299999999999, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910601, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910601, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Km/d+szJ+PlUT+MD3RjhERsAq1Q=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910601, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 29358, "operationId": 29358, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:40,844 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:40,844 - INFO - 1 alerts stored
2025-03-02 15:46:40,847 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:46:42,078 - INFO - System metrics collected
2025-03-02 15:46:43,262 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:46:44,238 - INFO - Processes monitored with VirusTotal
2025-03-02 15:46:44,239 - INFO - System logs collected
2025-03-02 15:46:44,239 - INFO - Security logs collected
2025-03-02 15:46:45,302 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D4128B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D4128B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D4128B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D4128B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:46:45,848 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:45,848 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:45,848 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:45,848 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.639995940029621e-05}
2025-03-02 15:46:45,848 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910601, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Km/d+szJ+PlUT+MD3RjhERsAq1Q=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 26962, "operationId": 26962, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:45,986 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 137.252, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 26962, "operationId": 26962, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:45,986 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:45,986 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:45,986 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:45,986 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:45,986 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.1900045946240425e-05}
2025-03-02 15:46:45,986 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 7, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910601, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Km/d+szJ+PlUT+MD3RjhERsAq1Q=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.7, \"memory_percent\": 63.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:46:42.078658\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1195.2, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:46:44.206337\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0.1...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24464, "operationId": 24464, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:46,183 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 197.00699999999998, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Nn9s+blhcAEDn06uFVYIwMX0BfY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24464, "operationId": 24464, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:46,183 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:46,184 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:46:46,184 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -55623981, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:46,184 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -55623981, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09313269995618612>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08306277997326107>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09535940000787377>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:46,184 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:46,184 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.2299932576715946e-05}
2025-03-02 15:46:46,184 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 8, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Nn9s+blhcAEDn06uFVYIwMX0BfY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:46:45.848025\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4300ee0003d68174affa7\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5705, "operationId": 5705, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:46,265 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 81.06700000000001, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Nn9s+blhcAEDn06uFVYIwMX0BfY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5705, "operationId": 5705, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:46,266 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:46,266 - INFO - 1 alerts stored
2025-03-02 15:46:46,267 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:46:46,586 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9845.064799999818, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:46Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:46Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:46,586 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:46,586 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9845.369899994694, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:46Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:46Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:46,587 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:46,587 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9844.233100069687, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:46Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:46Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:46,587 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:48,084 - INFO - System metrics collected
2025-03-02 15:46:49,281 - INFO - Processes monitored with VirusTotal
2025-03-02 15:46:49,281 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:46:49,281 - INFO - System logs collected
2025-03-02 15:46:50,305 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:46:51,269 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09139355996157975>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09500114396214487>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09476784002501518>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:51,269 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09139355996157975>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09500114396214487>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09476784002501518>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,270 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,270 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00033080007415264845}
2025-03-02 15:46:51,271 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Nn9s+blhcAEDn06uFVYIwMX0BfY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 28145, "operationId": 28145, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,414 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 143.71200000000002, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 28145, "operationId": 28145, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,414 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:51,415 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09139355996157975>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09500114396214487>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09476784002501518>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:51,415 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09139355996157975>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09500114396214487>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09476784002501518>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,415 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,415 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 4.910002462565899e-05}
2025-03-02 15:46:51,415 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 9, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910606, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Nn9s+blhcAEDn06uFVYIwMX0BfY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.7, \"memory_percent\": 63.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:46:48.084728\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1193.8, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:46:49.248118\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0.1...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23281, "operationId": 23281, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,687 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 271.885, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910611, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910611, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"zdMGXkF8sbfAiI3uW+Ht2v0wTIM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910611, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23281, "operationId": 23281, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,687 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:51,687 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:46:51,687 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 828530019, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09139355996157975>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09500114396214487>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09476784002501518>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:51,687 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 828530019, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09139355996157975>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09500114396214487>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.09476784002501518>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,688 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,688 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.299997378140688e-05}
2025-03-02 15:46:51,688 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 10, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910611, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"zdMGXkF8sbfAiI3uW+Ht2v0wTIM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:46:51.268649\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43013e0003d68174affa9\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16827, "operationId": 16827, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,815 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 127.08, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910612, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910612, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AnxkvlN0L+x+qtJeizriMUeOJMk=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910612, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16827, "operationId": 16827, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:51,815 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:51,815 - INFO - 1 alerts stored
2025-03-02 15:46:51,817 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:46:52,368 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D412FD0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D412FD0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D412FD0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D412FD0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:46:54,089 - INFO - System metrics collected
2025-03-02 15:46:54,327 - INFO - Processes monitored with VirusTotal
2025-03-02 15:46:54,327 - INFO - Security logs collected
2025-03-02 15:46:54,327 - INFO - System logs collected
2025-03-02 15:46:56,578 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9991.634099977091, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910616, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:56Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910616, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:56Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:56,578 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:56,581 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9994.378999923356, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910616, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:56Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910616, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:56Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:56,581 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:56,615 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10028.012700029649, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910616, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:16:56Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910616, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:16:56Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:46:56,617 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:46:56,818 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:56,818 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:56,818 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:56,818 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00010840001050382853}
2025-03-02 15:46:56,818 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910616, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"rJKcIL5kmIrBxxNcsbAdpsyP2wk=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 9961, "operationId": 9961, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:56,906 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 87.635, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 9961, "operationId": 9961, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:56,907 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:56,907 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:56,908 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:56,909 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:56,909 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0002549999626353383}
2025-03-02 15:46:56,910 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 11, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910616, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"rJKcIL5kmIrBxxNcsbAdpsyP2wk=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.4, \"memory_percent\": 63.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:46:54.089504\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1193.5, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:46:54.296212\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 491, "operationId": 491, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:57,147 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 237.535, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910617, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910617, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnGtiaUD7MIeKZpBgwL3L1V385A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910617, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 491, "operationId": 491, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:57,148 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:57,148 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:46:57,149 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1810964493, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:46:57,150 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1810964493, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:57,150 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:57,151 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0002730999840423465}
2025-03-02 15:46:57,151 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 12, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910617, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnGtiaUD7MIeKZpBgwL3L1V385A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:46:56.817904\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43019e0003d68174affab\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 2995, "operationId": 2995, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:57,230 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 79.444, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910617, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910617, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnGtiaUD7MIeKZpBgwL3L1V385A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910617, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 2995, "operationId": 2995, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:46:57,231 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:46:57,231 - INFO - 1 alerts stored
2025-03-02 15:46:57,232 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:46:57,371 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:46:59,373 - INFO - Processes monitored with VirusTotal
2025-03-02 15:46:59,374 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:46:59,374 - INFO - Security logs collected
2025-03-02 15:46:59,442 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D37EB10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D37EB10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D37EB10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D37EB10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:47:00,098 - INFO - System metrics collected
2025-03-02 15:47:02,233 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:02,233 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,233 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,234 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 9.089999366551638e-05}
2025-03-02 15:47:02,234 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910617, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnGtiaUD7MIeKZpBgwL3L1V385A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 11942, "operationId": 11942, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,357 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 123.52499999999999, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 11942, "operationId": 11942, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,358 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:02,359 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:02,359 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,360 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,360 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00034200004301965237}
2025-03-02 15:47:02,361 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 13, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910617, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnGtiaUD7MIeKZpBgwL3L1V385A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.6, \"memory_percent\": 63.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:00.098832\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1191.3, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:46:59.339127\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.9, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4827, "operationId": 4827, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,630 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 270.324, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910622, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910622, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"KZR6ssxj7p6QcAkI2oxNqrAXpoI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910622, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4827, "operationId": 4827, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,631 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:02,631 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:02,631 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -992251919, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:02,631 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -992251919, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09773230796679856>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09823489515576514>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10157123200967909>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,631 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,631 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.179992876946926e-05}
2025-03-02 15:47:02,632 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 14, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910622, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"KZR6ssxj7p6QcAkI2oxNqrAXpoI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:02.233449\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4301ee0003d68174affad\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5436, "operationId": 5436, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,717 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 85.09700000000001, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910622, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910622, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"KZR6ssxj7p6QcAkI2oxNqrAXpoI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910622, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5436, "operationId": 5436, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:02,717 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:02,717 - INFO - 1 alerts stored
2025-03-02 15:47:02,722 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:04,419 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:04,420 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:47:04,420 - INFO - Security logs collected
2025-03-02 15:47:04,443 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:47:06,109 - INFO - System metrics collected
2025-03-02 15:47:06,512 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:47:06,816 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10234.646399971098, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910626, \"i\": 6}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:06Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910626, \"i\": 6}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:06Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:06,818 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:06,819 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10201.847100048326, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910626, \"i\": 6}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:06Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910626, \"i\": 6}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:06Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:06,820 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:06,821 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10242.719099973328, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910626, \"i\": 6}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:06Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910626, \"i\": 6}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:06Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:06,822 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:07,722 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:07,723 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:07,723 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:07,723 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.239996921271086e-05}
2025-03-02 15:47:07,723 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910626, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"GXnd5Hh0aoD6s4E/JxITfd1h/1E=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 32391, "operationId": 32391, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:07,887 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 164.178, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 32391, "operationId": 32391, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:07,888 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:07,888 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:07,889 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:07,889 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:07,889 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0002524999435991049}
2025-03-02 15:47:07,891 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 15, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910626, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"GXnd5Hh0aoD6s4E/JxITfd1h/1E=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"memory_percent\": 63.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:06.109128\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1194.8, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:04.385787\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.6, \"memory_percent\": 0.12173595027986156, \"...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14604, "operationId": 14604, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:08,274 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 383.928, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910628, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910628, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xW+RICS+GUKTjwoafzb21j22+RI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910628, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14604, "operationId": 14604, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:08,275 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:08,275 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:08,276 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -783356346, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:08,277 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -783356346, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:08,277 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:08,277 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00026919995434582233}
2025-03-02 15:47:08,278 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 16, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910628, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xW+RICS+GUKTjwoafzb21j22+RI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:07.722678\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43024e0003d68174affaf\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3902, "operationId": 3902, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:08,365 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 86.76599999999999, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910628, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910628, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xW+RICS+GUKTjwoafzb21j22+RI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910628, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3902, "operationId": 3902, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:08,365 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:08,365 - INFO - 1 alerts stored
2025-03-02 15:47:08,368 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:09,461 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:09,461 - INFO - Security logs collected
2025-03-02 15:47:09,461 - INFO - System logs collected
2025-03-02 15:47:11,513 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:47:12,115 - INFO - System metrics collected
2025-03-02 15:47:13,369 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:13,370 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,371 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,371 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00040499994065612555}
2025-03-02 15:47:13,371 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910628, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xW+RICS+GUKTjwoafzb21j22+RI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 153, "operationId": 153, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,453 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 81.99199999999999, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 153, "operationId": 153, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,453 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:13,454 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:13,454 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,454 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,454 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 6.640003994107246e-05}
2025-03-02 15:47:13,454 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 17, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910628, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xW+RICS+GUKTjwoafzb21j22+RI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.3, \"memory_percent\": 63.5, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:12.114988\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1192.3, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:09.431135\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"memory_percent\": 0.12173595027986156, \"...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 292, "operationId": 292, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,548 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0050>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0050>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0050>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0050>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:47:13,843 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 388.855, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910634, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910634, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"1yXyAcciv9wk9rIAKaUCCI54rxM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910634, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 292, "operationId": 292, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,844 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:13,844 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:13,845 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1868676215, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:13,845 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1868676215, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09908244635071607>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10120241614431146>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10096370560508222>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,846 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,846 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00021309999283403158}
2025-03-02 15:47:13,846 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 18, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910634, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"1yXyAcciv9wk9rIAKaUCCI54rxM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:13.369541\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43029e0003d68174affb1\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12382, "operationId": 12382, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,936 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 90.205, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910634, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910634, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"1yXyAcciv9wk9rIAKaUCCI54rxM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910634, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12382, "operationId": 12382, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:13,937 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:13,938 - INFO - 1 alerts stored
2025-03-02 15:47:13,940 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:14,500 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:14,501 - INFO - System logs collected
2025-03-02 15:47:14,501 - INFO - Security logs collected
2025-03-02 15:47:16,759 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9935.81890000496, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910636, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:16Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910636, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:16Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:16,759 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:16,759 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9941.363400081173, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910636, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:16Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910636, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:16Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:16,760 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:16,760 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9938.994099968113, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910636, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:16Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910636, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:16Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:16,760 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:18,122 - INFO - System metrics collected
2025-03-02 15:47:18,550 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:47:18,941 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:18,941 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:18,941 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:18,941 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00012630003038793802}
2025-03-02 15:47:18,941 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910636, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"iGOzTcwMXIJu1ry3fYm7RuyEofE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 17421, "operationId": 17421, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,071 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 129.826, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 17421, "operationId": 17421, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,071 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:19,072 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:19,072 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,072 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,072 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 4.910002462565899e-05}
2025-03-02 15:47:19,072 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 19, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910636, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"iGOzTcwMXIJu1ry3fYm7RuyEofE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 2.5, \"memory_percent\": 63.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:18.122797\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1171.8, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:14.469980\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18716, "operationId": 18716, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,380 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 307.616, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910639, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910639, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"YdZEoNvJJL0UbU1SnjdYRjcT5B0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910639, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18716, "operationId": 18716, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,380 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:19,380 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:19,380 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1421706714, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:19,380 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1421706714, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.809997674077749e-05}
2025-03-02 15:47:19,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 20, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910639, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"YdZEoNvJJL0UbU1SnjdYRjcT5B0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:18.941029\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4302fe0003d68174affb3\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19718, "operationId": 19718, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,459 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 78.486, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910639, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910639, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"YdZEoNvJJL0UbU1SnjdYRjcT5B0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910639, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19718, "operationId": 19718, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:19,459 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:19,459 - INFO - 1 alerts stored
2025-03-02 15:47:19,461 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:19,542 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:19,543 - INFO - System logs collected
2025-03-02 15:47:19,543 - INFO - Security logs collected
2025-03-02 15:47:20,599 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:47:24,130 - INFO - System metrics collected
2025-03-02 15:47:24,462 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:24,462 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,462 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,462 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 9.240000508725643e-05}
2025-03-02 15:47:24,463 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910639, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"YdZEoNvJJL0UbU1SnjdYRjcT5B0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 19895, "operationId": 19895, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,587 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:24,587 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 124.33500000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 19895, "operationId": 19895, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,587 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:24,587 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:24,588 - INFO - System logs collected
2025-03-02 15:47:24,588 - INFO - Security logs collected
2025-03-02 15:47:24,588 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,588 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,588 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.830001413822174e-05}
2025-03-02 15:47:24,588 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 21, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910639, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"YdZEoNvJJL0UbU1SnjdYRjcT5B0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.5, \"memory_percent\": 63.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:24.130825\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1185.4, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:19.509135\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5447, "operationId": 5447, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,949 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 360.54, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910645, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910645, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AkWac3SJmkl6kwO8SkB9Rqs6Phc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910645, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5447, "operationId": 5447, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,949 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:24,949 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:24,949 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1421215301, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:24,950 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1421215301, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10457999707367274>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10479861292820428>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10520024446897211>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,950 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:24,950 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.8399979025125504e-05}
2025-03-02 15:47:24,950 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 22, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910645, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AkWac3SJmkl6kwO8SkB9Rqs6Phc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:24.462368\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43034e0003d68174affb5\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 21726, "operationId": 21726, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:25,036 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 86.411, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910645, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910645, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AkWac3SJmkl6kwO8SkB9Rqs6Phc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910645, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 21726, "operationId": 21726, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:25,037 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:25,037 - INFO - 1 alerts stored
2025-03-02 15:47:25,042 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:25,600 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:47:26,655 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9895.036899950355, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910646, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910646, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:26,656 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:26,658 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9898.560300003737, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910646, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910646, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:26,658 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:26,658 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9898.322900058702, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910646, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910646, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:26,659 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:27,657 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1260>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1260>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1260>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1260>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:47:29,630 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:29,630 - INFO - System logs collected
2025-03-02 15:47:29,630 - INFO - Security logs collected
2025-03-02 15:47:30,042 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:30,042 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,043 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,043 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00010460009798407555}
2025-03-02 15:47:30,043 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910646, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"vqj+eh0gDaSoy9laHh2E4s+ixgg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 14771, "operationId": 14771, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,129 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 85.867, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 14771, "operationId": 14771, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,129 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:30,129 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:30,129 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,129 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,129 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 6.720004603266716e-05}
2025-03-02 15:47:30,130 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 23, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910646, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"vqj+eh0gDaSoy9laHh2E4s+ixgg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.5, \"memory_percent\": 63.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:24.130825\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1195.1, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:29.595256\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11538, "operationId": 11538, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,137 - INFO - System metrics collected
2025-03-02 15:47:30,472 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 342.322, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910650, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910650, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"q3MTcRfETcun1yU65S2eYcpXNFo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910650, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11538, "operationId": 11538, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,473 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:30,473 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:30,474 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 809256149, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:30,475 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 809256149, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,476 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,476 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00027139997109770775}
2025-03-02 15:47:30,476 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 24, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910650, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"q3MTcRfETcun1yU65S2eYcpXNFo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:30.042568\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4303ae0003d68174affb7\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1869, "operationId": 1869, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,566 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 90.033, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910650, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910650, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"q3MTcRfETcun1yU65S2eYcpXNFo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910650, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1869, "operationId": 1869, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:30,567 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:30,568 - INFO - 1 alerts stored
2025-03-02 15:47:30,572 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:32,659 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:47:34,669 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:34,669 - INFO - Security logs collected
2025-03-02 15:47:34,669 - INFO - System logs collected
2025-03-02 15:47:34,732 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:47:35,573 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:35,573 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:35,574 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:35,574 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00033840001560747623}
2025-03-02 15:47:35,575 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910650, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"q3MTcRfETcun1yU65S2eYcpXNFo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 19912, "operationId": 19912, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:35,702 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 127.28900000000002, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 19912, "operationId": 19912, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:35,702 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:35,703 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:35,704 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:35,704 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:35,704 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0002269999822601676}
2025-03-02 15:47:35,705 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 25, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910650, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"q3MTcRfETcun1yU65S2eYcpXNFo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.3, \"memory_percent\": 63.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:30.137854\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1193.3, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:34.639224\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"memory_percent\": 0.12173595027986156, \"...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 25667, "operationId": 25667, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:36,000 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 295.47499999999997, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/0TmC/1pE8dD8kc2L05UZFCFU9o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 25667, "operationId": 25667, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:36,002 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:36,003 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:36,004 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1729275194, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:36,005 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1729275194, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09825229765795174>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10052385035768155>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10256643556532266>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:36,005 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:36,005 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.149992648512125e-05}
2025-03-02 15:47:36,005 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 26, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/0TmC/1pE8dD8kc2L05UZFCFU9o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:35.572611\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43040e0003d68174affb9\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 26299, "operationId": 26299, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:36,131 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 126.25500000000001, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/0TmC/1pE8dD8kc2L05UZFCFU9o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 26299, "operationId": 26299, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:36,132 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:36,133 - INFO - 1 alerts stored
2025-03-02 15:47:36,139 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:36,144 - INFO - System metrics collected
2025-03-02 15:47:36,900 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10241.909399977885, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 4}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 4}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:36,901 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:36,901 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10244.296799995936, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 4}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 4}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:36,901 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:36,901 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10242.682099924423, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 4}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 4}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:36,902 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:39,712 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:39,712 - INFO - System logs collected
2025-03-02 15:47:39,713 - INFO - Security logs collected
2025-03-02 15:47:39,733 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:47:41,139 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10295861811801049>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10537692029108112>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1043797884453744>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:41,140 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10295861811801049>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10537692029108112>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1043797884453744>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,140 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,140 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.210004307329655e-05}
2025-03-02 15:47:41,140 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/0TmC/1pE8dD8kc2L05UZFCFU9o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 17035, "operationId": 17035, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,226 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 86.03099999999999, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 17035, "operationId": 17035, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,226 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:41,226 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10295861811801049>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10537692029108112>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1043797884453744>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:41,227 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10295861811801049>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10537692029108112>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1043797884453744>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,227 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,227 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 9.58999153226614e-05}
2025-03-02 15:47:41,227 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 27, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910656, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/0TmC/1pE8dD8kc2L05UZFCFU9o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.3, \"memory_percent\": 63.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:36.144073\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1192.8, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:39.677145\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"memory_percent\": 0.12173595027986156, \"...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9894, "operationId": 9894, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,470 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 243.422, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910661, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910661, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HrK4Y7EPB7KFgmj8gk9Ohme/n9A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910661, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9894, "operationId": 9894, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,471 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:41,471 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:41,471 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -575030528, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10295861811801049>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10537692029108112>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1043797884453744>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:41,471 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -575030528, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10295861811801049>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10537692029108112>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1043797884453744>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,471 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,471 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.3900061175227165e-05}
2025-03-02 15:47:41,471 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 28, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910661, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HrK4Y7EPB7KFgmj8gk9Ohme/n9A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:41.139765\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43045e0003d68174affbb\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 28703, "operationId": 28703, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,565 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 93.528, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910661, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910661, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HrK4Y7EPB7KFgmj8gk9Ohme/n9A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910661, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 28703, "operationId": 28703, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:41,565 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:41,565 - INFO - 1 alerts stored
2025-03-02 15:47:41,567 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:41,803 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:47:42,149 - INFO - System metrics collected
2025-03-02 15:47:44,752 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:44,753 - INFO - System logs collected
2025-03-02 15:47:44,753 - INFO - Security logs collected
2025-03-02 15:47:46,568 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10295861811801049>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10537692029108112>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1043797884453744>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:46,569 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10295861811801049>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10537692029108112>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1043797884453744>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,569 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,570 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00034769997000694275}
2025-03-02 15:47:46,570 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910661, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HrK4Y7EPB7KFgmj8gk9Ohme/n9A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 23811, "operationId": 23811, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,606 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9704.515899997205, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910666, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:46Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910666, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:46Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:46,606 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:46,622 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9721.118899993598, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910666, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:46Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910666, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:46Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:46,623 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:46,626 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9723.943500081077, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910666, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:46Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910666, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:46Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:46,626 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:46,675 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 105.234, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 23811, "operationId": 23811, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,675 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:46,676 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:46,676 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,676 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,676 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.3699943237006664e-05}
2025-03-02 15:47:46,676 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 29, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910666, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"olAAXBlGNW1mcTct7QZrGexTQu8=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.9, \"memory_percent\": 63.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:42.149154\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1193.4, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:44.720627\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.6, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 31322, "operationId": 31322, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,805 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:47:46,965 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 288.695, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910667, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910667, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"vPdUfqx/J02o9TW4jwTMZGR9TrU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910667, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 31322, "operationId": 31322, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,965 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:46,965 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:46,965 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -524495212, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:46,965 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -524495212, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,965 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:46,966 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.40000619366765e-05}
2025-03-02 15:47:46,966 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 30, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910667, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"vPdUfqx/J02o9TW4jwTMZGR9TrU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:46.568060\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4304ae0003d68174affbd\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 30333, "operationId": 30333, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:47,056 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 90.345, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910667, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910667, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"vPdUfqx/J02o9TW4jwTMZGR9TrU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910667, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 30333, "operationId": 30333, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:47,056 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:47,056 - INFO - 1 alerts stored
2025-03-02 15:47:47,058 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:48,154 - INFO - System metrics collected
2025-03-02 15:47:48,857 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:47:49,794 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:49,794 - INFO - Security logs collected
2025-03-02 15:47:49,794 - INFO - System logs collected
2025-03-02 15:47:52,059 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:52,060 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,061 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,061 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00035149999894201756}
2025-03-02 15:47:52,061 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910667, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"vPdUfqx/J02o9TW4jwTMZGR9TrU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 17673, "operationId": 17673, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,157 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 95.405, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 17673, "operationId": 17673, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,157 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:52,157 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:52,157 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,157 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,157 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.3299940191209316e-05}
2025-03-02 15:47:52,158 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 31, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910667, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"vPdUfqx/J02o9TW4jwTMZGR9TrU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.8, \"memory_percent\": 63.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:48.154309\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1191.6, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:49.762353\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.6, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4664, "operationId": 4664, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,501 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 344.084, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910672, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910672, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"jTdczRqPJjYTZKxIhrc3AFzgn98=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910672, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4664, "operationId": 4664, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,502 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:52,502 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:52,502 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1701880806, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:52,502 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1701880806, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10280379448704574>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.10254907622530912>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10484615075146439>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,503 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,503 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 9.849993512034416e-05}
2025-03-02 15:47:52,503 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 32, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910672, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"jTdczRqPJjYTZKxIhrc3AFzgn98=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:52.059239\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43050e0003d68174affbf\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15141, "operationId": 15141, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,586 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 83.463, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910672, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910672, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"jTdczRqPJjYTZKxIhrc3AFzgn98=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910672, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15141, "operationId": 15141, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:52,587 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:52,588 - INFO - 1 alerts stored
2025-03-02 15:47:52,591 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:53,858 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:47:54,159 - INFO - System metrics collected
2025-03-02 15:47:54,835 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:54,835 - INFO - System logs collected
2025-03-02 15:47:54,836 - INFO - Security logs collected
2025-03-02 15:47:55,898 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:47:56,734 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10127.66580004245, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910676, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:56Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910676, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:56Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:56,734 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:56,735 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10112.198399961926, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az1\", \"region\": \"AP_SOUTH_1\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910676, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:56Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910676, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:56Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:56,735 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:56,736 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10109.839600045234, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910676, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:17:56Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910676, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:17:56Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:47:56,736 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:47:57,592 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:57,592 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,592 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,592 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.400005754083395e-05}
2025-03-02 15:47:57,592 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910676, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"QwmxJ0JKGU5qCFVIgzIQro7nwLs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 7711, "operationId": 7711, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,732 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 139.514, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 7711, "operationId": 7711, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,732 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:57,732 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:57,732 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,732 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,732 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 6.140000186860561e-05}
2025-03-02 15:47:57,733 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 33, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910676, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"QwmxJ0JKGU5qCFVIgzIQro7nwLs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.3, \"memory_percent\": 63.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:47:54.159779\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1190.6, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:54.803073\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.9, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 28253, "operationId": 28253, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,987 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 254.689, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910678, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910678, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TuVyxSEoKzlFvpcjCUJdpKgy8fg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910678, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 28253, "operationId": 28253, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,988 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:57,988 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:47:57,990 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 516547825, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:47:57,990 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 516547825, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,991 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:57,991 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00027870002668350935}
2025-03-02 15:47:57,991 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 34, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910678, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TuVyxSEoKzlFvpcjCUJdpKgy8fg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:47:57.591981\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43055e0003d68174affc1\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6868, "operationId": 6868, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:58,076 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 84.29899999999999, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910678, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910678, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TuVyxSEoKzlFvpcjCUJdpKgy8fg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910678, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6868, "operationId": 6868, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:47:58,076 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:47:58,076 - INFO - 1 alerts stored
2025-03-02 15:47:58,078 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:47:59,875 - INFO - Processes monitored with VirusTotal
2025-03-02 15:47:59,876 - INFO - System logs collected
2025-03-02 15:47:59,876 - INFO - Security logs collected
2025-03-02 15:48:00,165 - INFO - System metrics collected
2025-03-02 15:48:00,899 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:48:02,945 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1040>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1040>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1040>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1040>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:48:03,079 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:03,080 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,080 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,081 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0003426000475883484}
2025-03-02 15:48:03,081 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910678, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TuVyxSEoKzlFvpcjCUJdpKgy8fg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 25547, "operationId": 25547, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,214 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 133.041, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 25547, "operationId": 25547, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,214 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:03,214 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:03,215 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,215 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,215 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.9899986051023e-05}
2025-03-02 15:48:03,215 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 35, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910678, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TuVyxSEoKzlFvpcjCUJdpKgy8fg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.7, \"memory_percent\": 63.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:48:00.165450\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1190.3, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:47:59.843971\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27644, "operationId": 27644, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,559 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 343.887, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910683, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910683, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Fgo4dInNDzvHkwatonjGTRvLE+s=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910683, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27644, "operationId": 27644, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,559 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:03,559 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:48:03,560 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -208761588, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:03,560 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -208761588, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09863437558087829>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1013345209877405>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.10086458059289036>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,560 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,560 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 6.329989992082119e-05}
2025-03-02 15:48:03,560 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 36, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910683, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Fgo4dInNDzvHkwatonjGTRvLE+s=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:48:03.078901\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4305be0003d68174affc3\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 32662, "operationId": 32662, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,647 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 86.605, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910683, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910683, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Fgo4dInNDzvHkwatonjGTRvLE+s=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910683, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 32662, "operationId": 32662, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:03,648 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:03,648 - INFO - 1 alerts stored
2025-03-02 15:48:03,655 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:48:04,918 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:04,918 - INFO - Security logs collected
2025-03-02 15:48:04,918 - INFO - System logs collected
2025-03-02 15:48:06,170 - INFO - System metrics collected
2025-03-02 15:48:06,656 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9920.083700097166, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910686, \"i\": 6}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:06Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910686, \"i\": 6}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:06Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:06,657 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:06,658 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9923.22450003121, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910686, \"i\": 6}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:06Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910686, \"i\": 6}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:06Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:06,659 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9922.87310003303, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910686, \"i\": 6}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:06Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910686, \"i\": 6}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:06Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:06,660 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:06,662 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:07,946 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:48:08,655 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:08,656 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:08,656 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:08,656 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.939998224377632e-05}
2025-03-02 15:48:08,656 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910686, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"H5d0orUag8pvS9nY0EKAxCT1VQs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 32757, "operationId": 32757, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:08,789 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 133.14100000000002, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 32757, "operationId": 32757, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:08,790 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:08,790 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:08,790 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:08,791 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:08,791 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00016900000628083944}
2025-03-02 15:48:08,792 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 37, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910686, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"H5d0orUag8pvS9nY0EKAxCT1VQs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 2.1, \"memory_percent\": 63.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:48:06.170268\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1188.4, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:48:04.886094\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20037, "operationId": 20037, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:09,049 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 258.08599999999996, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910689, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910689, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/ImPaXzLcyknijttmEAoRk9YtzM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910689, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20037, "operationId": 20037, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:09,049 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:09,050 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:48:09,050 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1748847754, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:09,050 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1748847754, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:09,050 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:09,050 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.749997217208147e-05}
2025-03-02 15:48:09,050 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 38, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910689, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/ImPaXzLcyknijttmEAoRk9YtzM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:48:08.655742\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43061e0003d68174affc5\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12859, "operationId": 12859, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:09,135 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 84.968, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910689, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910689, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/ImPaXzLcyknijttmEAoRk9YtzM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910689, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12859, "operationId": 12859, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:09,136 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:09,136 - INFO - 1 alerts stored
2025-03-02 15:48:09,137 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:48:09,964 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:09,964 - INFO - System logs collected
2025-03-02 15:48:09,964 - INFO - Security logs collected
2025-03-02 15:48:10,013 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:48:12,178 - INFO - System metrics collected
2025-03-02 15:48:14,139 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:14,139 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,140 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,140 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00032590003684163094}
2025-03-02 15:48:14,141 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910689, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/ImPaXzLcyknijttmEAoRk9YtzM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 8723, "operationId": 8723, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,272 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 131.31, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 8723, "operationId": 8723, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,273 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:14,273 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:14,274 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,274 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,274 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0002759000053629279}
2025-03-02 15:48:14,276 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 39, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910689, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"/ImPaXzLcyknijttmEAoRk9YtzM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.8, \"memory_percent\": 63.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:48:12.178457\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1190.3, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:48:09.929653\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9741, "operationId": 9741, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,625 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 350.636, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910694, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910694, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"+vcxwS59C46ZMtm8fOzVAu7ME/o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910694, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9741, "operationId": 9741, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,626 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:14,626 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:48:14,626 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 240373682, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:14,626 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 240373682, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11500412046560146>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11702165677643775>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11101912445783996>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,626 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,626 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 6.120000034570694e-05}
2025-03-02 15:48:14,627 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 40, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910694, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"+vcxwS59C46ZMtm8fOzVAu7ME/o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:48:14.138581\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43066e0003d68174affc7\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27529, "operationId": 27529, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,716 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 89.654, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910694, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910694, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"+vcxwS59C46ZMtm8fOzVAu7ME/o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910694, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27529, "operationId": 27529, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:14,716 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:14,717 - INFO - 1 alerts stored
2025-03-02 15:48:14,718 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:48:14,994 - INFO - System logs collected
2025-03-02 15:48:14,994 - INFO - Security logs collected
2025-03-02 15:48:15,009 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:15,013 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:48:16,895 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10232.806500047445, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910696, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:16Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910696, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:16Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:16,895 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:16,896 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10238.30700002145, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910696, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:16Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910696, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:16Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:16,896 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:16,896 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10233.699399977922, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910696, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:16Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910696, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:16Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:16,897 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:17,045 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:48:18,183 - INFO - System metrics collected
2025-03-02 15:48:19,719 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:19,719 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:19,719 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:19,719 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.060003165155649e-05}
2025-03-02 15:48:19,719 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910696, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"voS1ZU9pCpBX1qeGz0X/5I85txE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 778, "operationId": 778, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:19,796 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 77.011, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 778, "operationId": 778, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:19,797 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:19,797 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:19,797 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:19,797 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:19,797 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.279993638396263e-05}
2025-03-02 15:48:19,798 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 41, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910696, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"voS1ZU9pCpBX1qeGz0X/5I85txE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.0, \"memory_percent\": 63.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:48:18.183893\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1181.0, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:48:14.974516\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12316, "operationId": 12316, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:19,995 - INFO - System logs collected
2025-03-02 15:48:19,996 - INFO - Security logs collected
2025-03-02 15:48:20,053 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:20,053 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 255.82399999999998, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910700, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910700, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"GU8ti7H/sMBFSdX9Ftt7V/XHPkE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910700, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12316, "operationId": 12316, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:20,053 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:20,053 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:48:20,054 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -2098201813, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:20,054 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -2098201813, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:20,054 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:20,054 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 6.670004222542048e-05}
2025-03-02 15:48:20,054 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 42, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910700, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"GU8ti7H/sMBFSdX9Ftt7V/XHPkE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:48:19.719265\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4306ce0003d68174affc9\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3035, "operationId": 3035, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:20,150 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 96.023, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910700, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910700, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"GU8ti7H/sMBFSdX9Ftt7V/XHPkE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910700, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3035, "operationId": 3035, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:20,150 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:20,150 - INFO - 1 alerts stored
2025-03-02 15:48:20,152 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:48:22,046 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:48:24,094 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:48:24,188 - INFO - System metrics collected
2025-03-02 15:48:24,997 - INFO - System logs collected
2025-03-02 15:48:24,997 - INFO - Security logs collected
2025-03-02 15:48:25,096 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:25,153 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:25,153 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:25,154 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:25,154 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.00010930001735687256}
2025-03-02 15:48:25,154 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910700, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"GU8ti7H/sMBFSdX9Ftt7V/XHPkE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 22190, "operationId": 22190, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:25,461 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 306.965, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 22190, "operationId": 22190, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:25,461 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:25,461 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:25,461 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11280455636885064>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11465532540409581>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11073489955663242>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:25,461 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:25,461 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.319993942975998e-05}
2025-03-02 15:48:25,462 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 43, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910700, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"GU8ti7H/sMBFSdX9Ftt7V/XHPkE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.0, \"memory_percent\": 63.6, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:48:24.188768\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1190.8, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:48:25.061589\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.6, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1842, "operationId": 1842, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:26,619 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9722.841200069524, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910706, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910706, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:26,619 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:26,657 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9760.61820005998, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910706, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910706, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:26,657 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:26,661 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9764.66139999684, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910706, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:26Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910706, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:26Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:26,662 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:26,993 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 1531.856, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910707, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910707, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"8D9lS2+/ck+RfjiG/ApdIyOpIkA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910707, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1842, "operationId": 1842, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:26,994 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:26,994 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:48:26,994 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 790032571, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11936546509508082>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11536960032262458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11765331963479167>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:26,994 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 790032571, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11936546509508082>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11536960032262458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11765331963479167>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:26,994 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:26,994 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 6.200000643730164e-05}
2025-03-02 15:48:26,994 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 44, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910707, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"8D9lS2+/ck+RfjiG/ApdIyOpIkA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:48:25.153481\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43072e0003d68174affcb\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 288, "operationId": 288, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:27,164 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 169.17399999999998, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910707, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910707, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"8D9lS2+/ck+RfjiG/ApdIyOpIkA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910707, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 288, "operationId": 288, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:27,164 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:27,164 - INFO - 1 alerts stored
2025-03-02 15:48:27,166 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:48:29,095 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:48:29,997 - INFO - System logs collected
2025-03-02 15:48:29,998 - INFO - Security logs collected
2025-03-02 15:48:30,137 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:30,193 - INFO - System metrics collected
2025-03-02 15:48:31,159 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:48:32,166 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11936546509508082>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11536960032262458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11765331963479167>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:32,167 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11936546509508082>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11536960032262458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11765331963479167>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,167 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,167 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.160003926604986e-05}
2025-03-02 15:48:32,167 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910707, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"8D9lS2+/ck+RfjiG/ApdIyOpIkA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 30106, "operationId": 30106, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,279 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 112.471, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 30106, "operationId": 30106, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,280 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:32,280 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11936546509508082>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11536960032262458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11765331963479167>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:32,280 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11936546509508082>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11536960032262458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11765331963479167>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,280 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,280 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 5.779997445642948e-05}
2025-03-02 15:48:32,280 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 45, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910707, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"8D9lS2+/ck+RfjiG/ApdIyOpIkA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.3, \"memory_percent\": 63.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:48:30.193832\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1186.0, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:48:30.105014\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1.5, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9040, "operationId": 9040, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,700 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 419.628, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910712, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910712, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"L7HzzU4NvHrXU189ZUwoVoot2eY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910712, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9040, "operationId": 9040, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,700 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:32,700 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:48:32,701 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1496635454, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11936546509508082>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11536960032262458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11765331963479167>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:32,701 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1496635454, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11936546509508082>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11536960032262458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11765331963479167>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,701 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,701 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 9.840005077421665e-05}
2025-03-02 15:48:32,701 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 46, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910712, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"L7HzzU4NvHrXU189ZUwoVoot2eY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:48:32.166831\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43078e0003d68174affcd\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 8942, "operationId": 8942, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,786 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 84.73, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910713, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910713, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"J0ClZgA1oGLzb0hSXtxcclwS+5I=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910713, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 8942, "operationId": 8942, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:32,786 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:32,786 - INFO - 1 alerts stored
2025-03-02 15:48:32,788 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:48:34,999 - INFO - System logs collected
2025-03-02 15:48:35,000 - INFO - Security logs collected
2025-03-02 15:48:35,180 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:36,160 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:48:36,199 - INFO - System metrics collected
2025-03-02 15:48:36,734 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10115.202900022268, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910716, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910716, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:36,735 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11209, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:36,736 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10073.947899974883, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910716, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910716, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:36,736 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 12352, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:36,736 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10078.916399972513, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910716, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:18:36Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910716, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:18:36Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:48:36,737 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 1, "serverConnectionId": 11715, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:48:37,789 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:37,789 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:37,789 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:37,789 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.499998901039362e-05}
2025-03-02 15:48:37,789 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910716, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"M46zqFSy6dapevcGMP2xHZsJCWU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 19264, "operationId": 19264, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:37,929 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 139.241, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 19264, "operationId": 19264, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:37,929 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:37,929 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:37,929 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:37,929 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:37,929 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 4.75000124424696e-05}
2025-03-02 15:48:37,930 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 47, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910716, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"M46zqFSy6dapevcGMP2xHZsJCWU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.4, \"memory_percent\": 63.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:48:36.199052\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1184.7, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:48:35.147143\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.9, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 22648, "operationId": 22648, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:38,202 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:48:38,338 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 408.47099999999995, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910718, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910718, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Q1lffQs+iNi4OlcAHSEltvq7U7Y=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910718, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 22648, "operationId": 22648, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:38,338 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:38,338 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:48:38,339 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1223440839, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:38,339 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1223440839, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:38,339 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:38,339 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.479998748749495e-05}
2025-03-02 15:48:38,339 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 48, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910718, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Q1lffQs+iNi4OlcAHSEltvq7U7Y=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:48:37.789135\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4307ee0003d68174affcf\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27446, "operationId": 27446, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:38,426 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 86.427, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910718, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910718, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Q1lffQs+iNi4OlcAHSEltvq7U7Y=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910718, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27446, "operationId": 27446, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:38,426 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:38,426 - INFO - 1 alerts stored
2025-03-02 15:48:38,428 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:48:40,000 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:48:40,001 - INFO - Security logs collected
2025-03-02 15:48:40,223 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:42,204 - INFO - System metrics collected
2025-03-02 15:48:43,203 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:48:43,429 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:43,429 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,429 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,429 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 7.350009400397539e-05}
2025-03-02 15:48:43,429 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910718, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Q1lffQs+iNi4OlcAHSEltvq7U7Y=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 23805, "operationId": 23805, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,514 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 84.52, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 23805, "operationId": 23805, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,514 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:43,514 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:43,514 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,514 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,514 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 6.980006583034992e-05}
2025-03-02 15:48:43,515 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 49, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910718, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Q1lffQs+iNi4OlcAHSEltvq7U7Y=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.3, \"memory_percent\": 63.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:48:42.204847\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1190.7, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:48:40.190161\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0....", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15890, "operationId": 15890, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,780 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 265.22499999999997, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910724, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910724, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"NtyOG6tnlrnLZ7rCXTUQpbSbOYo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910724, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15890, "operationId": 15890, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,780 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:43,780 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:48:43,780 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1511929095, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:43,781 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1511929095, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,781 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,781 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 8.999998681247234e-05}
2025-03-02 15:48:43,781 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"txnNumber\": 50, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910724, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"NtyOG6tnlrnLZ7rCXTUQpbSbOYo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:48:43.429015\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43083e0003d68174affd1\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6729, "operationId": 6729, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,868 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 87.51, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910724, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910724, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"NtyOG6tnlrnLZ7rCXTUQpbSbOYo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910724, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6729, "operationId": 6729, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:43,869 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:48:43,869 - INFO - 1 alerts stored
2025-03-02 15:48:43,870 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:48:45,002 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:48:45,002 - INFO - Security logs collected
2025-03-02 15:48:45,266 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:45,268 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:48:48,209 - INFO - System metrics collected
2025-03-02 15:48:48,872 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:48:48,872 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:48,873 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:48,873 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.0003226000117138028}
2025-03-02 15:48:48,874 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"X4C/EVRvSFaYCKvYMNQlAA==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910724, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"NtyOG6tnlrnLZ7rCXTUQpbSbOYo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 24370, "operationId": 24370, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:48:50,002 - INFO - System logs collected
2025-03-02 15:48:50,003 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:48:50,312 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:50,313 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:48:52,362 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:48:54,215 - INFO - System metrics collected
2025-03-02 15:48:55,003 - INFO - System logs collected
2025-03-02 15:48:55,004 - INFO - Security logs collected
2025-03-02 15:48:55,354 - INFO - Processes monitored with VirusTotal
2025-03-02 15:48:57,364 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:48:59,417 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:49:00,004 - INFO - System logs collected
2025-03-02 15:49:00,006 - INFO - Security logs collected
2025-03-02 15:49:00,220 - INFO - System metrics collected
2025-03-02 15:49:00,393 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:04,418 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:49:04,421 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)"))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 60, in create_connection
    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):
               ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\socket.py", line 977, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 11001] getaddrinfo failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 205, in _new_conn
    raise NameResolutionError(self.host, self, e) from e
urllib3.exceptions.NameResolutionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)"))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)"))

2025-03-02 15:49:05,006 - INFO - System logs collected
2025-03-02 15:49:05,007 - INFO - Security logs collected
2025-03-02 15:49:05,439 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:06,226 - INFO - System metrics collected
2025-03-02 15:49:06,745 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 30008.563700015657, "failure": "\"NetworkTimeout('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "driverConnectionId": 1, "message": "Server heartbeat failed"}
2025-03-02 15:49:06,745 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 30008.326899958774, "failure": "\"NetworkTimeout('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "driverConnectionId": 1, "message": "Server heartbeat failed"}
2025-03-02 15:49:06,745 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 30010.312699945644, "failure": "\"NetworkTimeout('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "driverConnectionId": 1, "message": "Server heartbeat failed"}
2025-03-02 15:49:06,745 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11241683570617157>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:06,746 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool cleared", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:06,746 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11306509207565368>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:06,746 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool cleared", "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:06,746 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.41310000233352184, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:06,747 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.11283244024277919>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:06,747 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.3160999622195959, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:06,747 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool cleared", "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:06,747 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:06,747 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:06,748 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.4556999774649739, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:06,748 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:07,218 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command failed", "durationMS": 18344.515, "failure": "{\"errmsg\": \"operation cancelled\", \"errtype\": \"_OperationCancelled\"}", "commandName": "ping", "databaseName": "admin", "requestId": 24370, "operationId": 24370, "driverConnectionId": 1, "serverConnectionId": 12522, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:07,218 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1}
2025-03-02 15:49:07,219 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection closed", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 1, "reason": "An error occurred while using the connection", "error": "error"}
2025-03-02 15:49:07,219 - WARNING - No internet/MongoDB connection. Storing locally.
2025-03-02 15:49:07,228 - INFO - Data stored locally in logs
2025-03-02 15:49:07,232 - INFO - Data stored locally in alerts
2025-03-02 15:49:09,422 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:49:09,425 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)"))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 60, in create_connection
    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):
               ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\socket.py", line 977, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 11001] getaddrinfo failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 205, in _new_conn
    raise NameResolutionError(self.host, self, e) from e
urllib3.exceptions.NameResolutionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)"))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)"))

2025-03-02 15:49:10,007 - INFO - System logs collected
2025-03-02 15:49:10,008 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:49:10,483 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:12,232 - INFO - System metrics collected
2025-03-02 15:49:12,233 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:12,233 - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "remainingTimeMS": 9}
2025-03-02 15:49:12,252 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.9551000548526645, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:12,252 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:12,253 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 1.5833999495953321, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:12,254 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:12,254 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 3.1148999696597457, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:12,255 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:12,755 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 1.4344999799504876, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:12,756 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 1.1708000674843788, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:12,756 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:12,757 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 1.5847000759094954, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:12,758 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:12,758 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:13,260 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 1.4968999894335866, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:13,261 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:13,262 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 3.0511999502778053, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:13,263 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:13,264 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 4.370599985122681, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:13,264 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:13,762 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.45409996528178453, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:13,762 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:13,764 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.2590999938547611, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:13,764 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:13,765 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.2114999806508422, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:13,765 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:14,263 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.4339000442996621, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:14,263 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:14,265 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.2356999320909381, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:14,265 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:14,266 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.2229000674560666, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:14,266 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:14,428 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:49:14,436 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)"))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 60, in create_connection
    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):
               ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\socket.py", line 977, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 11001] getaddrinfo failed

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 205, in _new_conn
    raise NameResolutionError(self.host, self, e) from e
urllib3.exceptions.NameResolutionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)"))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to resolve 'your-api-endpoint.localhost' ([Errno 11001] getaddrinfo failed)"))

2025-03-02 15:49:14,764 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.4729999927803874, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:14,764 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:14,765 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.31839997973293066, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:14,766 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:14,767 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.22999988868832588, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:14,767 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:15,008 - INFO - System logs collected
2025-03-02 15:49:15,010 - INFO - Security logs collected
2025-03-02 15:49:15,265 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.5219000158831477, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:15,265 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:15,267 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.34899997990578413, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:15,267 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:15,268 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.2905000001192093, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:15,268 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:15,526 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:15,766 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.4833000712096691, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:15,767 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:15,768 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.26030000299215317, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:15,768 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:15,769 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.22590009029954672, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:15,769 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:16,267 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.5193999968469143, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:16,268 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:16,269 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.2778000198304653, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:16,269 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:16,269 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.2663000486791134, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:16,270 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:16,769 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.4779000300914049, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:16,769 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:16,770 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.26439991779625416, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:16,770 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:16,771 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.301100080832839, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:16,771 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:17,270 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.4005000228062272, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:17,270 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:17,271 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.2321999054402113, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:17,271 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:17,271 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 0.2050000475719571, "failure": "\"AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')\"", "message": "Server heartbeat failed"}
2025-03-02 15:49:17,272 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:18,238 - INFO - System metrics collected
2025-03-02 15:49:18,249 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "message": "Server heartbeat started"}
2025-03-02 15:49:18,293 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "message": "Server heartbeat started"}
2025-03-02 15:49:18,293 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "message": "Server heartbeat started"}
2025-03-02 15:49:18,327 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 77.32390007004142, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910758, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910758, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:18,327 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool ready", "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:18,327 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "message": "Topology description changed"}
2025-03-02 15:49:18,328 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:18,407 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12587, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 114.22449990641326, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"ismaster\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910758, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910758, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMe...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:18,408 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool ready", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:18,408 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "message": "Topology description changed"}
2025-03-02 15:49:18,408 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12587, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:18,408 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:18,409 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:18,409 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection created", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:18,409 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": false, "durationMS": 115.5568000394851, "reply": "{\"helloOk\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910758, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910758, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:18,409 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection pool ready", "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:18,409 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "previousDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017: [Errno 11001] getaddrinfo failed (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "newDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "message": "Topology description changed"}
2025-03-02 15:49:18,410 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:19,011 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection ready", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.2676386000821367}
2025-03-02 15:49:19,011 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.6027178999502212}
2025-03-02 15:49:19,012 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910758, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"6yLJ4nf280DsKh7vDWabVntGtPM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 24393, "operationId": 24393, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,200 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 188.04199999999997, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 24393, "operationId": 24393, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,200 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:19,200 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:19,200 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,200 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,200 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.339994095265865e-05}
2025-03-02 15:49:19,201 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 1, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910758, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"6yLJ4nf280DsKh7vDWabVntGtPM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 3.0, \"memory_percent\": 63.5, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:49:12.232237\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1139.4, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:49:10.449102\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.6, \"memory_percent\": 0.1...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3548, "operationId": 3548, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,437 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:49:19,572 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 371.49199999999996, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910759, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910759, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sTx2yzx1PPeqPCmG0qBTqQjfB7c=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910759, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3548, "operationId": 3548, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,572 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:19,572 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:49:19,573 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -478020284, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:19,573 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -478020284, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,573 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,573 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.449998520314693e-05}
2025-03-02 15:49:19,574 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 2, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910759, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sTx2yzx1PPeqPCmG0qBTqQjfB7c=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\\\SYSTEM\", \"timestamp\": \"2025-03-02T15:49:12.233588\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430a7e0003d68174affd3\"}}]}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19629, "operationId": 19629, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,758 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 184.879, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910759, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910759, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sTx2yzx1PPeqPCmG0qBTqQjfB7c=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910759, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19629, "operationId": 19629, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,759 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:19,759 - INFO - 1 alerts stored
2025-03-02 15:49:19,762 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1369608396, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:19,762 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1369608396, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,762 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:19,762 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.0001058999914675951}
2025-03-02 15:49:19,763 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 3, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910759, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sTx2yzx1PPeqPCmG0qBTqQjfB7c=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.0, \"memory_percent\": 63.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:48:48.209679\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1188.2, \"memory_percent\": 4.856810304403014e-05, \"timestamp\": \"2025-03-02T15:48:45.232010\"}, {\"pid\": 4, \"name\": \"System\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 0.3, \"memory_percent\": 0.1...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12623, "operationId": 12623, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:20,009 - INFO - System logs collected
2025-03-02 15:49:20,011 - INFO - Security logs collected
2025-03-02 15:49:20,091 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 328.688, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910760, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910760, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Hx4PCyah2emEzWmDTHcda1kh6sI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910760, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12623, "operationId": 12623, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:20,091 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:20,092 - INFO - Synced 1 items from logs to MongoDB
2025-03-02 15:49:20,095 - INFO - Cleared local storage: logs
2025-03-02 15:49:20,097 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:49:20,570 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:21,452 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0050>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0050>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0050>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0050>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:49:24,244 - INFO - System metrics collected
2025-03-02 15:49:25,010 - INFO - System logs collected
2025-03-02 15:49:25,012 - INFO - Security logs collected
2025-03-02 15:49:25,098 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:25,098 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,098 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,099 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.409998215734959e-05}
2025-03-02 15:49:25,099 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910760, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Hx4PCyah2emEzWmDTHcda1kh6sI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 24084, "operationId": 24084, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,311 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 212.01500000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 24084, "operationId": 24084, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,311 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:25,311 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:25,312 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,312 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,312 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.0001629000762477517}
2025-03-02 15:49:25,313 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 4, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910760, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Hx4PCyah2emEzWmDTHcda1kh6sI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 25.9, \"memory_percent\": 64.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:49:24.244899\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19954, "operationId": 19954, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,614 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:25,811 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 498.91799999999995, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910766, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910766, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7Du+l/5WjktpmKOOOUrBtCCGspY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910766, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19954, "operationId": 19954, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,812 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:25,812 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:49:25,812 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1286486105, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:25,812 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1286486105, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.07732390007004142>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1155568000394851>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11422449990641326>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,812 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,812 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.780001033097506e-05}
2025-03-02 15:49:25,813 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 5, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910766, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7Du+l/5WjktpmKOOOUrBtCCGspY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:25.098435\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430ade0003d68174affd6\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:25.098450\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430ade0003d68174affd7\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:25.098453\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\"...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18756, "operationId": 18756, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,896 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 83.871, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910766, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910766, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7Du+l/5WjktpmKOOOUrBtCCGspY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910766, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18756, "operationId": 18756, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:25,897 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:25,897 - INFO - 5 alerts stored
2025-03-02 15:49:25,901 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:49:26,453 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:49:28,420 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10092.136499937624, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910768, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910768, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:28,421 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:28,497 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10088.784600025974, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910768, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910768, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:28,498 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:28,501 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:49:28,510 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10100.09419999551, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910768, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910768, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:28,511 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:30,012 - INFO - System logs collected
2025-03-02 15:49:30,013 - INFO - Security logs collected
2025-03-02 15:49:30,250 - INFO - System metrics collected
2025-03-02 15:49:30,657 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:30,901 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:30,902 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:30,902 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:30,902 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.949998300522566e-05}
2025-03-02 15:49:30,902 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910768, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Yc8Zz2QVeceEFbnhgs1/bOKa+8c=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 11840, "operationId": 11840, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,016 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 113.94600000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 11840, "operationId": 11840, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,016 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:31,016 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:31,017 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,017 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,017 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00010269996710121632}
2025-03-02 15:49:31,017 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 6, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910768, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Yc8Zz2QVeceEFbnhgs1/bOKa+8c=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.6, \"memory_percent\": 62.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:49:30.250610\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4966, "operationId": 4966, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,542 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 524.798, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910771, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910771, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"yL0hr3J6laLkiRE71tc7sLyVxew=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910771, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4966, "operationId": 4966, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,542 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:31,542 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:49:31,543 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 68559883, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:31,543 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 68559883, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,543 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,543 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.859994027763605e-05}
2025-03-02 15:49:31,543 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 7, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910771, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"yL0hr3J6laLkiRE71tc7sLyVxew=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:30.901625\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430b3e0003d68174affdc\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:30.901638\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430b3e0003d68174affdd\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:30.901640\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\"...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 7376, "operationId": 7376, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,794 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 250.78400000000002, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910771, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910771, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"yL0hr3J6laLkiRE71tc7sLyVxew=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910771, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 7376, "operationId": 7376, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:31,795 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:31,795 - INFO - 5 alerts stored
2025-03-02 15:49:31,797 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:49:33,502 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:49:35,014 - INFO - System logs collected
2025-03-02 15:49:35,015 - INFO - Security logs collected
2025-03-02 15:49:35,537 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0E20>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0E20>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0E20>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0E20>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:49:35,707 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:36,256 - INFO - System metrics collected
2025-03-02 15:49:36,798 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:36,798 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:36,798 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:36,798 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 9.53000271692872e-05}
2025-03-02 15:49:36,798 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910771, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"yL0hr3J6laLkiRE71tc7sLyVxew=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 13931, "operationId": 13931, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:36,924 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 125.76799999999999, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 13931, "operationId": 13931, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:36,924 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:36,925 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:36,925 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:36,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:36,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00011529994662851095}
2025-03-02 15:49:36,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 8, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910771, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"yL0hr3J6laLkiRE71tc7sLyVxew=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 11.7, \"memory_percent\": 64.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:49:36.256299\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 26308, "operationId": 26308, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:37,281 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 355.673, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910777, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910777, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"dMrdzDZDhe6R/+XGG5g18Zt1rJg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910777, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 26308, "operationId": 26308, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:37,281 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:37,281 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:49:37,282 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1811035016, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:37,282 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1811035016, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.08183930006343872>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1230206000385806>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11460481993854046>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:37,282 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:37,282 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.4699950851500034e-05}
2025-03-02 15:49:37,282 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 9, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910777, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"dMrdzDZDhe6R/+XGG5g18Zt1rJg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:36.798084\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430b9e0003d68174affe2\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:36.798098\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430b9e0003d68174affe3\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:36.798100\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\"...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16944, "operationId": 16944, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:37,380 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 98.41, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910777, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910777, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"dMrdzDZDhe6R/+XGG5g18Zt1rJg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910777, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16944, "operationId": 16944, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:37,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:37,381 - INFO - 6 alerts stored
2025-03-02 15:49:37,383 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:49:38,451 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10030.219900072552, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\", \"region\": \"AP_SOUTH_1\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910778, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910778, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:38,452 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:38,541 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10042.832299950533, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910778, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910778, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:38,541 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10030.352899921127, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910778, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910778, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:38,541 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:38,542 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:40,016 - INFO - System logs collected
2025-03-02 15:49:40,016 - INFO - Security logs collected
2025-03-02 15:49:40,538 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:49:40,750 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:42,262 - INFO - System metrics collected
2025-03-02 15:49:42,383 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:42,383 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,384 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,384 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.979998528957367e-05}
2025-03-02 15:49:42,384 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910778, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"nof8yLTYqURjr+VXygBT2dojmzs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 32439, "operationId": 32439, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,591 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 207.121, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 32439, "operationId": 32439, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,591 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:42,591 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:42,592 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,592 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,592 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.35999783501029e-05}
2025-03-02 15:49:42,592 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 10, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910778, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"nof8yLTYqURjr+VXygBT2dojmzs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.6, \"memory_percent\": 64.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:49:42.262251\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24626, "operationId": 24626, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,596 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:49:42,954 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 361.89500000000004, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910783, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910783, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZDFEL9Lyect2XdSiRIRamYv2e5o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910783, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24626, "operationId": 24626, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,954 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:42,954 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:49:42,955 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -442263914, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:42,955 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -442263914, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,955 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:42,955 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.7399971410632133e-05}
2025-03-02 15:49:42,955 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 11, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910783, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZDFEL9Lyect2XdSiRIRamYv2e5o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:42.383353\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430bee0003d68174affe9\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:42.383368\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430bee0003d68174affea\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:42.383370\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11323, "operationId": 11323, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:43,221 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 265.946, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910783, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910783, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZDFEL9Lyect2XdSiRIRamYv2e5o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910783, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11323, "operationId": 11323, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:43,221 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:43,221 - INFO - 5 alerts stored
2025-03-02 15:49:43,224 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:49:45,017 - INFO - System logs collected
2025-03-02 15:49:45,018 - INFO - Security logs collected
2025-03-02 15:49:45,797 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:47,597 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:49:48,225 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:48,225 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,226 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,226 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.82000133767724e-05}
2025-03-02 15:49:48,226 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910783, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZDFEL9Lyect2XdSiRIRamYv2e5o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 5537, "operationId": 5537, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,267 - INFO - System metrics collected
2025-03-02 15:49:48,314 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 87.95, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 5537, "operationId": 5537, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,314 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:48,314 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:48,314 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09042276005260647>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1464870800310746>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1160211359569803>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,314 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,314 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 4.859990440309048e-05}
2025-03-02 15:49:48,315 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 12, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910783, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZDFEL9Lyect2XdSiRIRamYv2e5o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.6, \"memory_percent\": 64.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:49:42.262251\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 21538, "operationId": 21538, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,560 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10108.476600027643, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910788, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910788, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:48,561 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:48,561 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10019.04529996682, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910788, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910788, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:48,561 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:48,561 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10019.601800013334, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910788, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910788, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:48,562 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:48,817 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 502.609, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910789, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910789, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"hlldXIW56Gqz5Av8w2xkyyjp72U=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910789, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 21538, "operationId": 21538, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,817 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:48,817 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:49:48,818 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1903691310, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09200798803754151>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13476192402094606>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11388550874870271>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:48,818 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1903691310, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09200798803754151>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13476192402094606>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11388550874870271>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,818 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,818 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.689996760338545e-05}
2025-03-02 15:49:48,818 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 13, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910789, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"hlldXIW56Gqz5Av8w2xkyyjp72U=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:48.225593\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430c4e0003d68174affef\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:48.225606\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430c4e0003d68174afff0\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:48.225608\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16118, "operationId": 16118, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,910 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 92.267, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910789, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910789, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"hlldXIW56Gqz5Av8w2xkyyjp72U=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910789, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16118, "operationId": 16118, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:48,911 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:48,911 - INFO - 5 alerts stored
2025-03-02 15:49:48,913 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:49:49,636 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:49:50,018 - INFO - System logs collected
2025-03-02 15:49:50,019 - INFO - Security logs collected
2025-03-02 15:49:50,843 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:53,913 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09200798803754151>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13476192402094606>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11388550874870271>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:53,913 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09200798803754151>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13476192402094606>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11388550874870271>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:53,914 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:53,914 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.729996625334024e-05}
2025-03-02 15:49:53,914 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910789, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"hlldXIW56Gqz5Av8w2xkyyjp72U=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 2082, "operationId": 2082, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,056 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 142.397, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 2082, "operationId": 2082, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,057 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:54,057 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09200798803754151>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13476192402094606>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11388550874870271>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:54,057 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09200798803754151>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13476192402094606>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11388550874870271>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,057 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,057 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.340001709759235e-05}
2025-03-02 15:49:54,057 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 14, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910789, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"hlldXIW56Gqz5Av8w2xkyyjp72U=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.8, \"memory_percent\": 64.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:49:48.267489\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 22929, "operationId": 22929, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,273 - INFO - System metrics collected
2025-03-02 15:49:54,594 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 537.049, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910794, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910794, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"iyezlRur061IlAhhtqB3DQ0S9TY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910794, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 22929, "operationId": 22929, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,594 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:54,594 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:49:54,595 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 157606490, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09200798803754151>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13476192402094606>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11388550874870271>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:54,595 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 157606490, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09200798803754151>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13476192402094606>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11388550874870271>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,595 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,595 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.780005060136318e-05}
2025-03-02 15:49:54,595 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 15, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910794, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"iyezlRur061IlAhhtqB3DQ0S9TY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:53.913499\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430cae0003d68174afff5\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:53.913514\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430cae0003d68174afff6\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:53.913516\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16541, "operationId": 16541, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,637 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:49:54,681 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 85.706, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910794, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910794, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"iyezlRur061IlAhhtqB3DQ0S9TY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910794, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16541, "operationId": 16541, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:54,681 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:54,681 - INFO - 5 alerts stored
2025-03-02 15:49:54,683 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:49:55,019 - INFO - System logs collected
2025-03-02 15:49:55,020 - INFO - Security logs collected
2025-03-02 15:49:55,887 - INFO - Processes monitored with VirusTotal
2025-03-02 15:49:56,695 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:49:58,444 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9883.267600089312, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910798, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910798, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:58,445 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:58,526 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9964.58969998639, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910798, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910798, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:58,527 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:58,527 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9966.028700000606, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910798, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:19:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910798, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:19:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:49:58,528 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:49:59,684 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:59,684 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:59,684 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:59,684 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.380005601793528e-05}
2025-03-02 15:49:59,684 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910798, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"iK42648jnZfzdPzQLY59vjBEHsc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 4833, "operationId": 4833, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:59,791 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 106.67, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 4833, "operationId": 4833, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:59,791 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:49:59,791 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:49:59,792 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:59,792 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:49:59,792 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.089999806135893e-05}
2025-03-02 15:49:59,792 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 16, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910798, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"iK42648jnZfzdPzQLY59vjBEHsc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.0, \"memory_percent\": 63.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:49:54.273141\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 31115, "operationId": 31115, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:00,021 - INFO - System logs collected
2025-03-02 15:50:00,022 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:50:00,279 - INFO - System metrics collected
2025-03-02 15:50:00,340 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 548.4480000000001, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910800, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910800, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"uFkZ/pkbBmmh4X3YPlFPKxByYTA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910800, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 31115, "operationId": 31115, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:00,341 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:00,341 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:00,341 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 674367467, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:00,341 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 674367467, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:00,341 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:00,341 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.289993714541197e-05}
2025-03-02 15:50:00,341 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 17, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910800, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"uFkZ/pkbBmmh4X3YPlFPKxByYTA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:59.684163\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430d0e0003d68174afffb\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:59.684177\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430d0e0003d68174afffc\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:49:59.684179\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4639, "operationId": 4639, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:00,431 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 89.81, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910800, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910800, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"uFkZ/pkbBmmh4X3YPlFPKxByYTA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910800, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4639, "operationId": 4639, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:00,431 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:00,431 - INFO - 5 alerts stored
2025-03-02 15:50:00,433 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:00,930 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:01,696 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:50:03,715 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:50:05,022 - INFO - System logs collected
2025-03-02 15:50:05,023 - INFO - Security logs collected
2025-03-02 15:50:05,434 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:05,434 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:05,434 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:05,434 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00010990002192556858}
2025-03-02 15:50:05,434 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910800, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"uFkZ/pkbBmmh4X3YPlFPKxByYTA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 29658, "operationId": 29658, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:05,549 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 114.468, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 29658, "operationId": 29658, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:05,549 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:05,549 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:05,549 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:05,549 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:05,549 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.809997674077749e-05}
2025-03-02 15:50:05,550 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 18, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910800, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"uFkZ/pkbBmmh4X3YPlFPKxByYTA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 13.6, \"memory_percent\": 64.3, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:00.279192\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 22704, "operationId": 22704, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:05,974 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:06,002 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 452.133, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910806, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910806, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"L28kWM1IpppOcvY5/genDZXClCc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910806, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 22704, "operationId": 22704, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:06,002 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:06,002 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:06,002 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1203725735, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:06,003 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1203725735, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.09447667043972761>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1343330191990361>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12054526699967683>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:06,003 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:06,003 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.509995389729738e-05}
2025-03-02 15:50:06,003 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 19, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910806, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"L28kWM1IpppOcvY5/genDZXClCc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:05.434099\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430d6e0003d68174b0001\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:05.434114\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430d6e0003d68174b0002\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:05.434116\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9930, "operationId": 9930, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:06,128 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 125.34699999999998, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910806, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910806, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"L28kWM1IpppOcvY5/genDZXClCc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910806, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9930, "operationId": 9930, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:06,129 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:06,129 - INFO - 5 alerts stored
2025-03-02 15:50:06,132 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:06,285 - INFO - System metrics collected
2025-03-02 15:50:08,444 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9999.599699978717, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910808, \"i\": 5}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910808, \"i\": 5}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:08,445 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:08,534 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10006.490999949165, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"availabilityZone\": \"aps1-az3\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910808, \"i\": 5}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910808, \"i\": 5}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:08,535 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:08,536 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10008.874000050128, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910808, \"i\": 5}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910808, \"i\": 5}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:08,536 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:08,716 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:50:10,023 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:50:10,024 - INFO - Security logs collected
2025-03-02 15:50:10,763 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0490>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0490>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0490>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0490>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:50:11,022 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:11,133 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:11,133 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,133 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,133 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.740008343011141e-05}
2025-03-02 15:50:11,134 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910808, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"+LP9u57fIt9dwL1NI0lWoFm+w5o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 13977, "operationId": 13977, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,214 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 80.43400000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 13977, "operationId": 13977, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,214 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:11,214 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:11,215 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,215 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,215 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.4299947805702686e-05}
2025-03-02 15:50:11,215 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 20, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910808, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"+LP9u57fIt9dwL1NI0lWoFm+w5o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.8, \"memory_percent\": 65.4, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:06.284971\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 2306, "operationId": 2306, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,571 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 355.899, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910811, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910811, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"UTS2VfDUj2fNCdF/kBQ+Km/o7QY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910811, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 2306, "operationId": 2306, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,571 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:11,571 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:11,571 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1350280715, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:11,571 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1350280715, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,572 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,572 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.429990753531456e-05}
2025-03-02 15:50:11,572 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 21, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910811, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"UTS2VfDUj2fNCdF/kBQ+Km/o7QY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:11.133340\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430dbe0003d68174b0007\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:11.133355\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430dbe0003d68174b0008\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:11.133357\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 31673, "operationId": 31673, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,671 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 98.75699999999999, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910811, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910811, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"UTS2VfDUj2fNCdF/kBQ+Km/o7QY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910811, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 31673, "operationId": 31673, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:11,671 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:11,671 - INFO - 5 alerts stored
2025-03-02 15:50:11,673 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:12,291 - INFO - System metrics collected
2025-03-02 15:50:15,024 - INFO - System logs collected
2025-03-02 15:50:15,026 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:50:15,765 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:50:16,065 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:16,674 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:16,674 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:16,674 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:16,674 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.869997691363096e-05}
2025-03-02 15:50:16,674 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910811, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"UTS2VfDUj2fNCdF/kBQ+Km/o7QY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 22386, "operationId": 22386, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:16,881 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 206.735, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 22386, "operationId": 22386, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:16,881 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:16,881 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:16,881 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:16,881 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:16,881 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.159992724657059e-05}
2025-03-02 15:50:16,882 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 22, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910811, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"UTS2VfDUj2fNCdF/kBQ+Km/o7QY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 8.0, \"memory_percent\": 65.6, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:12.291030\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5021, "operationId": 5021, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:17,371 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 489.72900000000004, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910817, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910817, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"6ZPFFWkBoo57yF/bGYrGgQY5eDc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910817, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5021, "operationId": 5021, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:17,372 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:17,373 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:17,374 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 356448562, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:17,374 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 356448562, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12268267635229976>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.139333115375191>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11381635359976441>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:17,375 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:17,375 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.0002734999870881438}
2025-03-02 15:50:17,376 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 23, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910817, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"6ZPFFWkBoo57yF/bGYrGgQY5eDc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:16.673850\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430e1e0003d68174b000d\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:16.673865\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430e1e0003d68174b000e\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:16.673867\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 28745, "operationId": 28745, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:17,456 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 80.594, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910817, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910817, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"6ZPFFWkBoo57yF/bGYrGgQY5eDc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910817, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 28745, "operationId": 28745, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:17,456 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:17,456 - INFO - 5 alerts stored
2025-03-02 15:50:17,458 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:17,827 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:50:18,296 - INFO - System metrics collected
2025-03-02 15:50:18,456 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10011.527900001965, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910818, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910818, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:18,457 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:18,616 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10081.202700035647, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910818, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910818, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:18,617 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:18,617 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10080.218799994327, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910818, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910818, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:18,617 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:20,025 - INFO - System logs collected
2025-03-02 15:50:20,027 - INFO - Security logs collected
2025-03-02 15:50:21,110 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:22,458 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:22,459 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,459 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,459 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.990002632141113e-05}
2025-03-02 15:50:22,459 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910818, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"cceBUsJjXQHIlUw1IX0rhMCHCu4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 26924, "operationId": 26924, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,551 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 92.181, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 26924, "operationId": 26924, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,551 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:22,551 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:22,552 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,552 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,552 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.1999930292367935e-05}
2025-03-02 15:50:22,552 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 24, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910818, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"cceBUsJjXQHIlUw1IX0rhMCHCu4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 3.3, \"memory_percent\": 64.6, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:18.296890\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19072, "operationId": 19072, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,828 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:50:22,912 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 359.761, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910823, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910823, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"m27tFI/+2IipEiLvJaGwzRGHivI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910823, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19072, "operationId": 19072, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,912 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:22,912 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:22,912 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1042285710, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:22,913 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1042285710, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,913 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:22,913 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.8999983593821526e-05}
2025-03-02 15:50:22,913 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 25, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910823, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"m27tFI/+2IipEiLvJaGwzRGHivI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:22.458756\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430e6e0003d68174b0013\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:22.458770\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430e6e0003d68174b0014\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:22.458772\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6270, "operationId": 6270, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:23,001 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 88.025, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910823, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910823, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"m27tFI/+2IipEiLvJaGwzRGHivI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910823, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6270, "operationId": 6270, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:23,001 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:23,001 - INFO - 6 alerts stored
2025-03-02 15:50:23,003 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:24,302 - INFO - System metrics collected
2025-03-02 15:50:24,883 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:50:25,026 - INFO - System logs collected
2025-03-02 15:50:25,028 - INFO - Security logs collected
2025-03-02 15:50:26,155 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:28,004 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:28,004 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,004 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,004 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.800001185387373e-05}
2025-03-02 15:50:28,004 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910823, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"m27tFI/+2IipEiLvJaGwzRGHivI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 5829, "operationId": 5829, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,169 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 164.281, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 5829, "operationId": 5829, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,169 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:28,170 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:28,170 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.12330630109065774>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14985845231660458>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.11163652287068965>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,171 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,171 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00025290006306022406}
2025-03-02 15:50:28,173 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 26, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910823, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"m27tFI/+2IipEiLvJaGwzRGHivI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 4.2, \"memory_percent\": 64.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:24.302628\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 26777, "operationId": 26777, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,492 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10034.410699969158, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:28,493 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:28,539 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9921.361700049601, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:28,539 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:28,541 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9924.460200010799, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:28,542 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:28,762 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 590.2180000000001, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"tDVEuV0tWLUkHe0SaPtwpvFPG0s=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 26777, "operationId": 26777, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,763 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:28,763 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:28,765 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 25811546, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13417022087613198>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1660042618595049>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12166907829582096>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:28,765 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 25811546, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13417022087613198>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1660042618595049>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12166907829582096>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,766 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,766 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00027630000840872526}
2025-03-02 15:50:28,767 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 27, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910828, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"tDVEuV0tWLUkHe0SaPtwpvFPG0s=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:28.004119\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430ece0003d68174b001a\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:28.004134\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430ece0003d68174b001b\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:28.004136\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15573, "operationId": 15573, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,863 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 96.036, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910829, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910829, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"KaDOmC390YnEfytBLXbB5rCXXxE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910829, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15573, "operationId": 15573, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:28,863 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:28,864 - INFO - 5 alerts stored
2025-03-02 15:50:28,870 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:29,884 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:50:30,028 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:50:30,030 - INFO - Security logs collected
2025-03-02 15:50:30,308 - INFO - System metrics collected
2025-03-02 15:50:31,197 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:31,914 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:50:33,871 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13417022087613198>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1660042618595049>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12166907829582096>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:33,872 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13417022087613198>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1660042618595049>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12166907829582096>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:33,872 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:33,872 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.000345399952493608}
2025-03-02 15:50:33,873 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910829, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"KaDOmC390YnEfytBLXbB5rCXXxE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 5097, "operationId": 5097, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:33,980 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 107.817, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 5097, "operationId": 5097, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:33,981 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:33,981 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13417022087613198>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1660042618595049>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12166907829582096>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:33,981 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13417022087613198>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1660042618595049>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12166907829582096>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:33,981 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:33,981 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.1999930292367935e-05}
2025-03-02 15:50:33,982 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 28, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910829, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"KaDOmC390YnEfytBLXbB5rCXXxE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 2.6, \"memory_percent\": 64.7, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:30.308708\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16512, "operationId": 16512, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:34,436 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 454.277, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910834, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910834, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"LxYksccELzMp7+icteQUT77w2vM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910834, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16512, "operationId": 16512, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:34,436 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:34,436 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:34,436 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1587830466, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13417022087613198>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1660042618595049>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12166907829582096>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:34,436 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1587830466, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.13417022087613198>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1660042618595049>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.12166907829582096>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:34,437 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:34,437 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.850009620189667e-05}
2025-03-02 15:50:34,437 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 29, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910834, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"LxYksccELzMp7+icteQUT77w2vM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:33.870804\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430f2e0003d68174b0020\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:33.870847\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430f2e0003d68174b0021\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:33.870855\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23986, "operationId": 23986, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:34,521 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 83.86699999999999, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910834, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910834, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"LxYksccELzMp7+icteQUT77w2vM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910834, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23986, "operationId": 23986, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:34,521 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:34,521 - INFO - 5 alerts stored
2025-03-02 15:50:34,523 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:35,029 - INFO - System logs collected
2025-03-02 15:50:35,031 - INFO - Security logs collected
2025-03-02 15:50:36,241 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:36,314 - INFO - System metrics collected
2025-03-02 15:50:36,915 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:50:38,481 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9987.472099950537, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910838, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910838, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:38,483 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:38,571 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10031.871699960902, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910838, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910838, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:38,572 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:38,572 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10030.096600065008, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910838, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910838, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:38,572 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:38,978 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:50:39,524 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:39,525 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:39,525 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:39,526 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.0003344999859109521}
2025-03-02 15:50:39,526 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910838, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"nS9NST2rdQFpsBnjiWMck8joBP4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 13290, "operationId": 13290, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:39,651 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 124.695, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 13290, "operationId": 13290, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:39,651 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:39,651 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:39,651 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:39,651 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:39,651 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.319993942975998e-05}
2025-03-02 15:50:39,652 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 30, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910838, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"nS9NST2rdQFpsBnjiWMck8joBP4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 5.6, \"memory_percent\": 64.7, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:36.314293\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9161, "operationId": 9161, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:40,011 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 359.35499999999996, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910840, \"i\": 44}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910840, \"i\": 44}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Dx5glbgxVAfg53v+jCxcoilDOow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910840, \"i\": 44}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9161, "operationId": 9161, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:40,012 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:40,012 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:40,013 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 50509494, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:40,013 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 50509494, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:40,013 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:40,013 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.5299955420196056e-05}
2025-03-02 15:50:40,013 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 31, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910840, \"i\": 44}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Dx5glbgxVAfg53v+jCxcoilDOow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:39.524118\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430f8e0003d68174b0026\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:39.524169\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430f8e0003d68174b0027\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:39.524180\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18636, "operationId": 18636, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:40,030 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:50:40,032 - INFO - Security logs collected
2025-03-02 15:50:40,194 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 180.98, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910840, \"i\": 45}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910840, \"i\": 45}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Dx5glbgxVAfg53v+jCxcoilDOow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910840, \"i\": 45}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18636, "operationId": 18636, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:40,195 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:40,195 - INFO - 6 alerts stored
2025-03-02 15:50:40,198 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:41,283 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:42,320 - INFO - System metrics collected
2025-03-02 15:50:43,980 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:50:45,033 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:50:45,034 - INFO - Security logs collected
2025-03-02 15:50:45,198 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:45,199 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,199 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,199 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.670007809996605e-05}
2025-03-02 15:50:45,199 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910840, \"i\": 45}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Dx5glbgxVAfg53v+jCxcoilDOow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 22355, "operationId": 22355, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,321 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 121.699, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 22355, "operationId": 22355, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,321 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:45,321 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:45,321 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,321 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,321 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.180000491440296e-05}
2025-03-02 15:50:45,322 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 32, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910840, \"i\": 45}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Dx5glbgxVAfg53v+jCxcoilDOow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 6.6, \"memory_percent\": 64.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:42.320396\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24767, "operationId": 24767, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,594 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 272.113, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910845, \"i\": 6}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910845, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"UXwGKxaejbgFRtHX4o4ILz58+vs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910845, \"i\": 6}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24767, "operationId": 24767, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,594 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:45,595 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:45,596 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 654852058, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:45,597 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 654852058, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24424451668934588>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16820754947759092>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2039951426377547>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,597 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,597 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.0002753000007942319}
2025-03-02 15:50:45,598 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 33, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910845, \"i\": 6}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"UXwGKxaejbgFRtHX4o4ILz58+vs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:45.198705\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430fde0003d68174b002d\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:45.198719\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c430fde0003d68174b002e\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:45.198720\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23655, "operationId": 23655, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,779 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 181.773, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910846, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910846, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"y7CPGRYTaaRnoagZ/tLL20nvKYU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910846, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23655, "operationId": 23655, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:45,780 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:45,780 - INFO - 5 alerts stored
2025-03-02 15:50:45,782 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:46,007 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:50:46,328 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:48,326 - INFO - System metrics collected
2025-03-02 15:50:48,587 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10103.825300000608, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910848, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910848, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:48,588 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:48,589 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10016.940500005148, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910848, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910848, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:48,591 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:48,592 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10020.024300087243, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910848, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910848, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:48,592 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:50,034 - INFO - System logs collected
2025-03-02 15:50:50,035 - INFO - Security logs collected
2025-03-02 15:50:50,782 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:50,782 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:50,783 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:50,783 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00012990005780011415}
2025-03-02 15:50:50,783 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910848, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Kgsuqf49QEW+6McFMGdhgunsIKU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 15574, "operationId": 15574, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:50,992 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 208.841, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 15574, "operationId": 15574, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:50,992 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:50,992 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:50,992 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:50,992 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:50,992 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.819997750222683e-05}
2025-03-02 15:50:50,993 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 34, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910848, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Kgsuqf49QEW+6McFMGdhgunsIKU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 8.1, \"memory_percent\": 64.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:48.326002\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4031, "operationId": 4031, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:51,008 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:50:51,260 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 268.00600000000003, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910851, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910851, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"tgVxIDCrPZDEkL3nwmSaCDGhWTY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910851, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4031, "operationId": 4031, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:51,261 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:51,261 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:51,261 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 2049792593, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:51,261 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 2049792593, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:51,262 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:51,262 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.070003241300583e-05}
2025-03-02 15:50:51,262 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 35, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910851, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"tgVxIDCrPZDEkL3nwmSaCDGhWTY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:50.782470\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43103e0003d68174b0033\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:50.782504\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43103e0003d68174b0034\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:50.782506\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12052, "operationId": 12052, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:51,371 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:51,372 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 109.779, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910851, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910851, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"tgVxIDCrPZDEkL3nwmSaCDGhWTY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910851, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12052, "operationId": 12052, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:51,372 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:51,372 - INFO - 6 alerts stored
2025-03-02 15:50:51,374 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:53,079 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0490>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0490>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0490>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0490>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:50:54,331 - INFO - System metrics collected
2025-03-02 15:50:55,035 - INFO - System logs collected
2025-03-02 15:50:55,036 - INFO - Security logs collected
2025-03-02 15:50:56,381 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:56,381 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 9.109999518841505e-05}
2025-03-02 15:50:56,396 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910851, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"tgVxIDCrPZDEkL3nwmSaCDGhWTY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 27350, "operationId": 27350, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,412 - INFO - Processes monitored with VirusTotal
2025-03-02 15:50:56,494 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 98.558, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 27350, "operationId": 27350, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,495 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:56,495 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:56,495 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,495 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,495 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.230004899203777e-05}
2025-03-02 15:50:56,495 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 36, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910851, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"tgVxIDCrPZDEkL3nwmSaCDGhWTY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 3.9, \"memory_percent\": 64.9, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:50:54.331799\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1150, "operationId": 1150, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,802 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 306.572, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910857, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910857, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AoSJ10Q2H61vRuNzeoU4Qk2nAek=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910857, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1150, "operationId": 1150, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,802 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:56,802 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:50:56,802 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 399282286, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:50:56,803 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 399282286, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2309086333556225>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23195785958255732>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2101401541003979>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,803 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,803 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.46001023799181e-05}
2025-03-02 15:50:56,803 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 37, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910857, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AoSJ10Q2H61vRuNzeoU4Qk2nAek=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:56.381007\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43108e0003d68174b003a\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:56.381016\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43108e0003d68174b003b\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:50:56.381018\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16941, "operationId": 16941, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,958 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 154.761, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910857, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910857, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"AoSJ10Q2H61vRuNzeoU4Qk2nAek=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910857, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16941, "operationId": 16941, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:50:56,958 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:50:56,958 - INFO - 5 alerts stored
2025-03-02 15:50:56,960 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:50:58,080 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:50:58,476 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9887.360600056127, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910858, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910858, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:58,476 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:58,556 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9963.81270000711, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910858, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910858, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:58,556 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:50:58,568 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9976.793700014241, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910858, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:20:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910858, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:20:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:50:58,568 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:00,036 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:51:00,037 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:51:00,121 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0380>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:51:00,337 - INFO - System metrics collected
2025-03-02 15:51:01,455 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:01,961 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:01,961 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:01,961 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:01,961 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.51999905332923e-05}
2025-03-02 15:51:01,961 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910858, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"hvhCTNIJ81ZPPi/RAoPM4/q37z0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 21724, "operationId": 21724, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,061 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 100.111, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 21724, "operationId": 21724, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,062 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:02,063 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:02,063 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,064 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,064 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.0002685999497771263}
2025-03-02 15:51:02,066 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 38, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910858, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"hvhCTNIJ81ZPPi/RAoPM4/q37z0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 4.0, \"memory_percent\": 65.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:00.337066\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 13966, "operationId": 13966, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,511 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 446.56, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910862, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910862, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"F7OS8d4l2c1EsS9rhy+yZT8Hc8E=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910862, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 13966, "operationId": 13966, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,511 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:02,511 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:02,512 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1531435786, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:02,512 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1531435786, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,512 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,512 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.10999995842576e-05}
2025-03-02 15:51:02,512 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 39, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910862, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"F7OS8d4l2c1EsS9rhy+yZT8Hc8E=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:01.961010\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4310ee0003d68174b0040\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:01.961023\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4310ee0003d68174b0041\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:01.961025\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3430, "operationId": 3430, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,608 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 95.9, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910862, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910862, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"F7OS8d4l2c1EsS9rhy+yZT8Hc8E=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910862, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3430, "operationId": 3430, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:02,609 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:02,610 - INFO - 5 alerts stored
2025-03-02 15:51:02,616 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:05,037 - INFO - System logs collected
2025-03-02 15:51:05,039 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:51:05,122 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:51:06,342 - INFO - System metrics collected
2025-03-02 15:51:06,500 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:07,157 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:51:07,617 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:07,617 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:07,618 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:07,618 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00013159995432943106}
2025-03-02 15:51:07,618 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910862, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"F7OS8d4l2c1EsS9rhy+yZT8Hc8E=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 31107, "operationId": 31107, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:07,911 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 293.39500000000004, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 31107, "operationId": 31107, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:07,912 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:07,913 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:07,913 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:07,914 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:07,914 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00025429995730519295}
2025-03-02 15:51:07,915 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 40, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910862, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"F7OS8d4l2c1EsS9rhy+yZT8Hc8E=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.8, \"memory_percent\": 64.6, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:06.342089\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 30191, "operationId": 30191, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:08,451 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 536.6379999999999, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7XoNmnMzrcWdnHMO6YfROSpxPPg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 30191, "operationId": 30191, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:08,451 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:08,451 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:08,451 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1527950992, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:08,452 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1527950992, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23088740669217955>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.20816988767259642>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.18427002328682865>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:08,452 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:08,452 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.7300087064504623e-05}
2025-03-02 15:51:08,452 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 41, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7XoNmnMzrcWdnHMO6YfROSpxPPg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:07.617339\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43114e0003d68174b0046\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:07.617357\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43114e0003d68174b0047\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:07.617361\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18007, "operationId": 18007, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:08,475 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9998.389199958183, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:08,475 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:08,552 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 100.23400000000001, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7XoNmnMzrcWdnHMO6YfROSpxPPg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18007, "operationId": 18007, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:08,553 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:08,553 - INFO - 5 alerts stored
2025-03-02 15:51:08,560 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:08,566 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10009.387700003572, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 5}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 5}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:08,567 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:08,576 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10007.526599918492, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 5}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 5}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:08,576 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:10,039 - INFO - System logs collected
2025-03-02 15:51:10,040 - INFO - Security logs collected
2025-03-02 15:51:11,540 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:12,159 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:51:12,351 - INFO - System metrics collected
2025-03-02 15:51:13,561 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24078352536096476>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18501057013697833>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1782110986346542>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:13,561 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24078352536096476>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18501057013697833>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1782110986346542>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:13,561 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:13,561 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.570007048547268e-05}
2025-03-02 15:51:13,562 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7XoNmnMzrcWdnHMO6YfROSpxPPg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 11337, "operationId": 11337, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:13,773 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 211.35999999999999, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 11337, "operationId": 11337, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:13,773 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:13,773 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24078352536096476>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18501057013697833>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1782110986346542>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:13,773 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24078352536096476>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18501057013697833>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1782110986346542>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:13,774 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:13,774 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.7999975979328156e-05}
2025-03-02 15:51:13,774 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 42, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910868, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7XoNmnMzrcWdnHMO6YfROSpxPPg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.0, \"memory_percent\": 64.7, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:12.351015\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:49:19\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15457, "operationId": 15457, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:14,218 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:51:14,405 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 631.223, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910874, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910874, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ilSJTQqJhdrdqNrJckxF27s+zKE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910874, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15457, "operationId": 15457, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:14,405 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:14,405 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:14,406 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1200813633, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24078352536096476>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18501057013697833>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1782110986346542>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:14,406 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1200813633, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24078352536096476>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18501057013697833>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1782110986346542>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:14,406 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:14,406 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 9.099999442696571e-05}
2025-03-02 15:51:14,406 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 43, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910874, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ilSJTQqJhdrdqNrJckxF27s+zKE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:13.561286\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4311ae0003d68174b004c\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:13.561298\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4311ae0003d68174b004d\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:13.561300\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12287, "operationId": 12287, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:14,489 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 83.122, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910874, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910874, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ilSJTQqJhdrdqNrJckxF27s+zKE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910874, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12287, "operationId": 12287, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:14,490 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:14,490 - INFO - 5 alerts stored
2025-03-02 15:51:14,492 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:15,040 - INFO - System logs collected
2025-03-02 15:51:15,041 - INFO - Security logs collected
2025-03-02 15:51:16,584 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:18,356 - INFO - System metrics collected
2025-03-02 15:51:18,654 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10179.034299915656, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910878, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910878, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:18,655 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:18,656 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10089.196600019932, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910878, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910878, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:18,657 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:18,657 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10080.334199941717, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910878, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910878, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:18,657 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:19,219 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:51:19,493 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:19,493 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,493 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,493 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.650000043213367e-05}
2025-03-02 15:51:19,493 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910878, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"lBR9foPAni4SVZMESiHdOcJ+WCw=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 27753, "operationId": 27753, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,611 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 117.881, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 27753, "operationId": 27753, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,611 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:19,611 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:19,611 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,611 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,612 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.149992648512125e-05}
2025-03-02 15:51:19,612 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 44, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910878, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"lBR9foPAni4SVZMESiHdOcJ+WCw=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 9.5, \"memory_percent\": 67.6, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:18.356736\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}], \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1140.0, \"memory_percent\": 4.856810304...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 10383, "operationId": 10383, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,974 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 362.783, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910880, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910880, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"emDY76bWECNSNlFDmFqyCGXYUzg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910880, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 10383, "operationId": 10383, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,975 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:19,975 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:19,975 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 853995318, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:19,975 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 853995318, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,975 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:19,976 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.180000491440296e-05}
2025-03-02 15:51:19,976 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 45, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910880, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"emDY76bWECNSNlFDmFqyCGXYUzg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:19.492893\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4311fe0003d68174b0052\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:19.492908\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4311fe0003d68174b0053\"}}, {\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\SYSTEM\", \"timestamp\": \"2025-03-02T15:51:19.492911\", \"ag...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14945, "operationId": 14945, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:20,041 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:51:20,042 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:51:20,077 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 101.195, "reply": "{\"n\": 3, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910880, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910880, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"emDY76bWECNSNlFDmFqyCGXYUzg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910880, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14945, "operationId": 14945, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:20,077 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:20,077 - INFO - 3 alerts stored
2025-03-02 15:51:20,080 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:21,239 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:51:21,629 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:24,361 - INFO - System metrics collected
2025-03-02 15:51:25,042 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:51:25,044 - INFO - Security logs collected
2025-03-02 15:51:25,081 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:25,081 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:25,081 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:25,081 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.859990000724792e-05}
2025-03-02 15:51:25,081 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910880, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"emDY76bWECNSNlFDmFqyCGXYUzg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 8909, "operationId": 8909, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:26,241 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:51:26,574 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 1493.08, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 8909, "operationId": 8909, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:26,574 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:26,575 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:26,575 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:26,575 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:26,575 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.0600036047399044e-05}
2025-03-02 15:51:26,576 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 46, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910880, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"emDY76bWECNSNlFDmFqyCGXYUzg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 6.6, \"memory_percent\": 64.4, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:24.361903\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}], \"processes\": [{\"name\": \"System Idle Process\", \"username\": \"NT AUTHORITY\\SYSTEM\", \"cpu_percent\": 1097.4, \"memory_percent\": 4.856810304...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 32209, "operationId": 32209, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:26,675 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:27,352 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 776.975, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910887, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910887, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HWA9Fhor4YuwcO/pvHAudFMOjLo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910887, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 32209, "operationId": 32209, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:27,352 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:27,352 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:27,353 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1094370312, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:27,353 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1094370312, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3280821202957873>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17830465611119498>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1591944789132234>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:27,353 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:27,353 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.009999196976423e-05}
2025-03-02 15:51:27,353 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 47, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910887, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HWA9Fhor4YuwcO/pvHAudFMOjLo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:25.081007\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43127e0003d68174b0056\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:25.081021\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43127e0003d68174b0057\"}}, {\"type\": \"Suspicious Process\", \"severity\": \"Medium\", \"details\": \"System Idle Process (PID: 0) by NT AUTHORITY\\SYSTEM\", \"timestamp\": \"2025-03-02T15:51:25.081024\", \"ag...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9758, "operationId": 9758, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:27,441 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 87.831, "reply": "{\"n\": 4, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910887, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910887, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HWA9Fhor4YuwcO/pvHAudFMOjLo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910887, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 9758, "operationId": 9758, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:27,441 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:27,441 - INFO - 4 alerts stored
2025-03-02 15:51:27,443 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:28,255 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1370>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1370>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1370>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1370>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:51:28,575 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9919.688800000586, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910888, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910888, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:28,576 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:28,612 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9954.99750005547, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910888, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910888, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:28,612 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:28,612 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9955.319999950007, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910888, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910888, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:28,613 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:30,044 - INFO - System logs collected
2025-03-02 15:51:30,046 - INFO - Security logs collected
2025-03-02 15:51:30,367 - INFO - System metrics collected
2025-03-02 15:51:31,718 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:32,444 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:32,444 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,444 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,444 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.95999076217413e-05}
2025-03-02 15:51:32,444 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910888, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Ur23aTakTT9XcJD61GKhLA2BHsA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 24221, "operationId": 24221, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,527 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 82.569, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 24221, "operationId": 24221, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,527 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:32,527 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:32,527 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,528 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,528 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.889998283237219e-05}
2025-03-02 15:51:32,528 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 48, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910888, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Ur23aTakTT9XcJD61GKhLA2BHsA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 6.5, \"memory_percent\": 64.5, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:30.367787\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18588, "operationId": 18588, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,782 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 254.24799999999996, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910893, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910893, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"n2alOTRwc2LzeDr0kQ03amvXWYY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910893, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18588, "operationId": 18588, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,782 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:32,782 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:32,783 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -7696769, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:32,783 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -7696769, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,783 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,783 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 9.50000248849392e-05}
2025-03-02 15:51:32,783 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 49, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910893, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"n2alOTRwc2LzeDr0kQ03amvXWYY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:32.444254\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4312ce0003d68174b005b\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:32.444266\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4312ce0003d68174b005c\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:32.444268\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6422, "operationId": 6422, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,973 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 189.366, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910893, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910893, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"n2alOTRwc2LzeDr0kQ03amvXWYY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910893, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6422, "operationId": 6422, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:32,973 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:32,973 - INFO - 6 alerts stored
2025-03-02 15:51:32,975 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:33,256 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:51:35,047 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:51:35,048 - INFO - Security logs collected
2025-03-02 15:51:35,267 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:51:36,377 - INFO - System metrics collected
2025-03-02 15:51:36,763 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:37,976 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:37,976 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:37,976 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:37,976 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.280008867383003e-05}
2025-03-02 15:51:37,976 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910893, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"n2alOTRwc2LzeDr0kQ03amvXWYY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 24946, "operationId": 24946, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,065 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 88.545, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 24946, "operationId": 24946, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,065 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:38,065 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:38,065 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,065 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,065 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.580003537237644e-05}
2025-03-02 15:51:38,066 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 50, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910893, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"n2alOTRwc2LzeDr0kQ03amvXWYY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.0, \"memory_percent\": 64.6, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:36.377709\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27506, "operationId": 27506, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,422 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 356.907, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnG405yeC6InhLhnmw2xBg16ON8=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27506, "operationId": 27506, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,423 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:38,423 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:38,423 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1580748863, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:38,423 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1580748863, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3128601962370322>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1715065848728845>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16164242313449384>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,423 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,424 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.709996912628412e-05}
2025-03-02 15:51:38,424 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 51, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnG405yeC6InhLhnmw2xBg16ON8=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:37.976100\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43132e0003d68174b0062\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:37.976113\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43132e0003d68174b0063\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:37.976115\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 13030, "operationId": 13030, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,512 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9935.042399913073, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:38,513 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:38,514 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 90.122, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnG405yeC6InhLhnmw2xBg16ON8=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 13030, "operationId": 13030, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:38,514 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:38,515 - INFO - 5 alerts stored
2025-03-02 15:51:38,521 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:38,602 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9989.400599966757, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:38,603 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:38,608 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9995.146700064652, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:38,610 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:40,048 - INFO - System logs collected
2025-03-02 15:51:40,049 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:51:40,269 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:51:41,802 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:42,336 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F09E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F09E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F09E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F09E0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:51:42,385 - INFO - System metrics collected
2025-03-02 15:51:43,522 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2840091569923229>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.26614644789652664>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14970425851807834>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:43,522 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2840091569923229>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.26614644789652664>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14970425851807834>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:43,522 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:43,522 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.429998368024826e-05}
2025-03-02 15:51:43,522 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnG405yeC6InhLhnmw2xBg16ON8=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 16413, "operationId": 16413, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:43,773 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 250.84099999999998, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 16413, "operationId": 16413, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:43,773 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:43,774 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2840091569923229>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.26614644789652664>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14970425851807834>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:43,774 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2840091569923229>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.26614644789652664>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14970425851807834>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:43,774 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:43,774 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.000003147870302e-05}
2025-03-02 15:51:43,774 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 52, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910898, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DnG405yeC6InhLhnmw2xBg16ON8=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.9, \"memory_percent\": 64.6, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:42.385942\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 29168, "operationId": 29168, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:44,091 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 317.46999999999997, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910904, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910904, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZulQLDITQlbW8bo/797NejFuv6s=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910904, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 29168, "operationId": 29168, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:44,092 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:44,092 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:44,092 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1076977856, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2840091569923229>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.26614644789652664>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14970425851807834>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:44,092 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1076977856, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2840091569923229>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.26614644789652664>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14970425851807834>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:44,092 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:44,092 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.430002395063639e-05}
2025-03-02 15:51:44,092 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 53, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910904, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZulQLDITQlbW8bo/797NejFuv6s=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:43.522270\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43138e0003d68174b0068\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:43.522283\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43138e0003d68174b0069\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:43.522284\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 900, "operationId": 900, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:44,181 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 88.63300000000001, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910904, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910904, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZulQLDITQlbW8bo/797NejFuv6s=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910904, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 900, "operationId": 900, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:44,181 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:44,181 - INFO - 5 alerts stored
2025-03-02 15:51:44,183 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:45,049 - INFO - System logs collected
2025-03-02 15:51:45,050 - INFO - Security logs collected
2025-03-02 15:51:46,848 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:47,337 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:51:48,395 - INFO - System metrics collected
2025-03-02 15:51:48,553 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10039.256699965335, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910908, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910908, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:48,555 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:48,597 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9992.947199963965, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910908, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910908, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:48,597 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:48,617 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10006.703600054607, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910908, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910908, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:48,617 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:49,184 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:49,184 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,184 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,184 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.46001023799181e-05}
2025-03-02 15:51:49,184 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910908, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"fG+WuEK5ib2hom+ZA81w26KcFII=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 32591, "operationId": 32591, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,311 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 127.08900000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 32591, "operationId": 32591, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,312 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:49,313 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:49,313 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,314 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,314 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.0002532999496906996}
2025-03-02 15:51:49,316 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 54, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910908, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"fG+WuEK5ib2hom+ZA81w26KcFII=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 2.9, \"memory_percent\": 64.7, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:48.395009\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18762, "operationId": 18762, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,387 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:51:49,581 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 266.368, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910909, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910909, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"4uANNQKJh3n98g+dtXXuXOxSQ3o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910909, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18762, "operationId": 18762, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,581 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:49,581 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:49,581 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1975128521, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:49,582 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1975128521, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,582 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,582 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.779997445642948e-05}
2025-03-02 15:51:49,582 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 55, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910909, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"4uANNQKJh3n98g+dtXXuXOxSQ3o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:49.184103\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4313de0003d68174b006e\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:49.184116\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4313de0003d68174b006f\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:49.184117\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1655, "operationId": 1655, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,779 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 197.43, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910909, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910909, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"4uANNQKJh3n98g+dtXXuXOxSQ3o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910909, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1655, "operationId": 1655, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:49,780 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:49,780 - INFO - 5 alerts stored
2025-03-02 15:51:49,781 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:50,050 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:51:50,052 - INFO - Security logs collected
2025-03-02 15:51:51,889 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:54,390 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:51:54,401 - INFO - System metrics collected
2025-03-02 15:51:54,782 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:54,782 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:54,782 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:54,782 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.479998748749495e-05}
2025-03-02 15:51:54,783 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910909, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"4uANNQKJh3n98g+dtXXuXOxSQ3o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 17410, "operationId": 17410, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:54,891 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 108.178, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 17410, "operationId": 17410, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:54,891 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:54,891 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:54,891 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:54,891 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:54,891 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.510007031261921e-05}
2025-03-02 15:51:54,892 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 56, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910909, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"4uANNQKJh3n98g+dtXXuXOxSQ3o=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.3, \"memory_percent\": 64.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:54.401863\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6359, "operationId": 6359, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:55,053 - INFO - System logs collected
2025-03-02 15:51:55,055 - INFO - Security logs collected
2025-03-02 15:51:55,175 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 283.792, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910915, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910915, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sxMCTA8wq+Aj34ri1JjqPIVWPCQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910915, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6359, "operationId": 6359, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:55,176 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:55,177 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:51:55,178 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1055422948, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:51:55,178 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1055422948, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.27617498557950493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2989591782981809>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2687023268140994>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:55,179 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:55,179 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00027109996881335974}
2025-03-02 15:51:55,180 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 57, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910915, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sxMCTA8wq+Aj34ri1JjqPIVWPCQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:54.782435\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43143e0003d68174b0074\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:54.782448\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43143e0003d68174b0075\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:51:54.782450\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27624, "operationId": 27624, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:55,271 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 91.711, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910915, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910915, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sxMCTA8wq+Aj34ri1JjqPIVWPCQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910915, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27624, "operationId": 27624, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:51:55,271 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:51:55,272 - INFO - 5 alerts stored
2025-03-02 15:51:55,273 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:51:56,448 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0C00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:51:56,935 - INFO - Processes monitored with VirusTotal
2025-03-02 15:51:58,761 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10163.884100038558, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910918, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910918, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:58,762 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:58,762 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10207.264499971643, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910918, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910918, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:58,762 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:51:58,763 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10145.461900043301, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910918, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:21:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910918, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:21:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:51:58,763 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:00,054 - INFO - System logs collected
2025-03-02 15:52:00,056 - INFO - Security logs collected
2025-03-02 15:52:00,274 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:00,274 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,275 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,275 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.809997234493494e-05}
2025-03-02 15:52:00,275 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910918, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"gDEGIr6gHunGww4AEhi7erWcO34=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 20537, "operationId": 20537, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 105.92500000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 20537, "operationId": 20537, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:00,381 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:00,381 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.359994247555733e-05}
2025-03-02 15:52:00,382 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 58, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910918, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"gDEGIr6gHunGww4AEhi7erWcO34=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.3, \"memory_percent\": 64.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:51:54.401863\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 21548, "operationId": 21548, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,407 - INFO - System metrics collected
2025-03-02 15:52:00,691 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 309.198, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910920, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910920, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"10Lcv5tNaFnKAJT2yrR8cGIV7oI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910920, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 21548, "operationId": 21548, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,691 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:00,691 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:00,691 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1331323717, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:00,692 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1331323717, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,692 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,692 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.589995998889208e-05}
2025-03-02 15:52:00,692 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 59, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910920, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"10Lcv5tNaFnKAJT2yrR8cGIV7oI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:00.274543\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43148e0003d68174b007a\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:00.274559\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43148e0003d68174b007b\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:00.274562\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6483, "operationId": 6483, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,797 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 104.835, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910921, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910921, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sYvavM2bmr+cOTsXtZcF+ikBVQQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910921, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6483, "operationId": 6483, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:00,797 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:00,797 - INFO - 5 alerts stored
2025-03-02 15:52:00,799 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:01,449 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:52:01,980 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:03,511 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:52:05,055 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:52:05,057 - INFO - Security logs collected
2025-03-02 15:52:05,800 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:05,800 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:05,800 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:05,800 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.610007353127003e-05}
2025-03-02 15:52:05,800 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910921, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sYvavM2bmr+cOTsXtZcF+ikBVQQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 27595, "operationId": 27595, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:06,414 - INFO - System metrics collected
2025-03-02 15:52:06,616 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 815.477, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 27595, "operationId": 27595, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:06,616 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:06,616 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:06,616 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:06,616 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:06,616 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.540007259696722e-05}
2025-03-02 15:52:06,617 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 60, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910921, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"sYvavM2bmr+cOTsXtZcF+ikBVQQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 3.2, \"memory_percent\": 64.7, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:00.407653\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4041, "operationId": 4041, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:07,024 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:07,185 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 568.7919999999999, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910927, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910927, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HwO9o47sC5KtzUCQ2/rXbZPRue0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910927, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4041, "operationId": 4041, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:07,185 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:07,185 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:07,186 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -222002145, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:07,186 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -222002145, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3690367084764401>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2669296026471481>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.25190916145698367>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:07,186 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:07,186 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.9399986639618874e-05}
2025-03-02 15:52:07,186 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 61, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910927, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HwO9o47sC5KtzUCQ2/rXbZPRue0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:05.799855\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4314fe0003d68174b0080\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:05.799868\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4314fe0003d68174b0081\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:05.799870\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3602, "operationId": 3602, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:07,311 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 124.82300000000001, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910927, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910927, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"HwO9o47sC5KtzUCQ2/rXbZPRue0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910927, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3602, "operationId": 3602, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:07,311 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:07,311 - INFO - 5 alerts stored
2025-03-02 15:52:07,313 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:08,512 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:52:08,576 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9813.038899912499, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910928, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910928, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:08,576 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:08,616 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9853.918900014833, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910928, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910928, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:08,618 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:08,661 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9898.166200029664, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910928, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910928, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:08,661 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:10,056 - INFO - System logs collected
2025-03-02 15:52:10,058 - INFO - Security logs collected
2025-03-02 15:52:10,525 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:52:12,068 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:12,314 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:12,314 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,314 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,314 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.960002403706312e-05}
2025-03-02 15:52:12,314 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910928, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ictNCAg3SIYc26DAy6A27nu2qek=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 24350, "operationId": 24350, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,394 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 79.65899999999999, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 24350, "operationId": 24350, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,394 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:12,394 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:12,394 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,395 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,395 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.009999196976423e-05}
2025-03-02 15:52:12,395 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 62, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910928, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ictNCAg3SIYc26DAy6A27nu2qek=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.4, \"memory_percent\": 64.6, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:06.414055\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 10291, "operationId": 10291, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,419 - INFO - System metrics collected
2025-03-02 15:52:12,823 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 428.548, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910933, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910933, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"zfyQglMubQKODX7t5KtZcNv9thQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910933, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 10291, "operationId": 10291, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,824 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:12,824 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:12,824 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1218357007, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:12,824 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1218357007, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,824 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,824 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.889994256198406e-05}
2025-03-02 15:52:12,825 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 63, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910933, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"zfyQglMubQKODX7t5KtZcNv9thQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:12.314186\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43154e0003d68174b0086\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:12.314200\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43154e0003d68174b0087\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:12.314204\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 30836, "operationId": 30836, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,919 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 94.121, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910933, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910933, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"zfyQglMubQKODX7t5KtZcNv9thQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910933, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 30836, "operationId": 30836, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:12,919 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:12,920 - INFO - 5 alerts stored
2025-03-02 15:52:12,924 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:15,057 - INFO - System logs collected
2025-03-02 15:52:15,059 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:52:15,526 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:52:17,116 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:17,565 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327350>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:52:17,924 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:17,925 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:17,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:17,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 9.139999747276306e-05}
2025-03-02 15:52:17,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910933, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"zfyQglMubQKODX7t5KtZcNv9thQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 9374, "operationId": 9374, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,216 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 291.439, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 9374, "operationId": 9374, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,217 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:18,217 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:18,217 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,217 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,217 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.879998207092285e-05}
2025-03-02 15:52:18,217 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 64, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910933, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"zfyQglMubQKODX7t5KtZcNv9thQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.8, \"memory_percent\": 64.5, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:12.419160\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11020, "operationId": 11020, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,429 - INFO - System metrics collected
2025-03-02 15:52:18,652 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 434.447, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZTTZx61CuteekJS2X1UhVJl8iqU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11020, "operationId": 11020, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,652 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:18,652 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:18,652 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1220577419, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:18,653 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10076.541299931705, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:18,653 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1220577419, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3365976067827635>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24405476212571864>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.2398358891756327>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,653 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10034.331600065343, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:18,653 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9991.32309993729, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:18,653 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:18,653 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,654 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:18,654 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:18,654 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.0007673000218346715}
2025-03-02 15:52:18,654 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 65, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910938, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ZTTZx61CuteekJS2X1UhVJl8iqU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:17.924649\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4315ae0003d68174b008c\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:17.924662\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4315ae0003d68174b008d\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:17.924664\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4596, "operationId": 4596, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,741 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 86.897, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910939, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910939, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"5cFxhMLyZexRNMEaZRuiJKfLNFo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910939, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 4596, "operationId": 4596, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:18,742 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:18,742 - INFO - 5 alerts stored
2025-03-02 15:52:18,743 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:20,058 - INFO - System logs collected
2025-03-02 15:52:20,060 - INFO - Security logs collected
2025-03-02 15:52:22,163 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:22,566 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:52:23,744 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.42792758541998216>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3351463896945158>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.23737143132210206>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:23,744 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.42792758541998216>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3351463896945158>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.23737143132210206>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:23,745 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:23,745 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.170008029788733e-05}
2025-03-02 15:52:23,745 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910939, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"5cFxhMLyZexRNMEaZRuiJKfLNFo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 24021, "operationId": 24021, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:23,825 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 80.738, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 24021, "operationId": 24021, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:23,826 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:23,826 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.42792758541998216>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3351463896945158>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.23737143132210206>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:23,826 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.42792758541998216>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3351463896945158>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.23737143132210206>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:23,826 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:23,826 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 4.9200025387108326e-05}
2025-03-02 15:52:23,826 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 66, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910939, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"5cFxhMLyZexRNMEaZRuiJKfLNFo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.5, \"memory_percent\": 64.5, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:18.429002\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27348, "operationId": 27348, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:24,129 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 302.788, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910944, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910944, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"aEERHapbzvmCKe0M3v7qXCKtwpM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910944, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27348, "operationId": 27348, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:24,129 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:24,129 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:24,130 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1427924038, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.42792758541998216>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3351463896945158>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.23737143132210206>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:24,130 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1427924038, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.42792758541998216>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3351463896945158>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.23737143132210206>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:24,130 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:24,130 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.470002699643373e-05}
2025-03-02 15:52:24,130 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 67, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910944, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"aEERHapbzvmCKe0M3v7qXCKtwpM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:23.744541\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43160e0003d68174b0092\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:23.744552\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43160e0003d68174b0093\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:23.744554\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23199, "operationId": 23199, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:24,219 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 88.895, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910944, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910944, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"aEERHapbzvmCKe0M3v7qXCKtwpM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910944, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23199, "operationId": 23199, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:24,219 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:24,219 - INFO - 5 alerts stored
2025-03-02 15:52:24,221 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:24,434 - INFO - System metrics collected
2025-03-02 15:52:24,611 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:52:25,059 - INFO - System logs collected
2025-03-02 15:52:25,061 - INFO - Security logs collected
2025-03-02 15:52:27,210 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:28,538 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9884.020199999213, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az1\", \"region\": \"AP_SOUTH_1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910948, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910948, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:28,539 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:28,627 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9972.396299941465, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910948, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910948, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:28,627 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:28,637 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9982.238900032826, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910948, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910948, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:28,637 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:29,222 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:29,222 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,222 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,222 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.36000544950366e-05}
2025-03-02 15:52:29,222 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910948, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"dgj17Thg00RFa0wzgA3AQyAYD1Y=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 19668, "operationId": 19668, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,324 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 101.993, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 19668, "operationId": 19668, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,325 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:29,325 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:29,325 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,325 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,325 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.849997978657484e-05}
2025-03-02 15:52:29,325 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 68, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910948, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"dgj17Thg00RFa0wzgA3AQyAYD1Y=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.0, \"memory_percent\": 64.9, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:24.434509\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24484, "operationId": 24484, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,612 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:52:29,687 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 362.104, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910949, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910949, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"11wu7zvsaqW5vBRZBCqNAODPR6Q=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910949, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24484, "operationId": 24484, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,687 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:29,687 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:29,688 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1466684729, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:29,688 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1466684729, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,688 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,688 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.130000110715628e-05}
2025-03-02 15:52:29,688 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 69, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910949, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"11wu7zvsaqW5vBRZBCqNAODPR6Q=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:29.222082\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43165e0003d68174b0098\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:29.222096\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43165e0003d68174b0099\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:29.222097\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 8281, "operationId": 8281, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,812 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 123.479, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910950, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910950, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"d1tuY4cMEQipcLsLlx9qYggG5Jg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910950, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 8281, "operationId": 8281, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:29,812 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:29,812 - INFO - 5 alerts stored
2025-03-02 15:52:29,814 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:30,061 - INFO - System logs collected
2025-03-02 15:52:30,063 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:52:30,440 - INFO - System metrics collected
2025-03-02 15:52:31,638 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:52:32,254 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:34,815 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:34,815 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:34,815 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:34,815 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.410005830228329e-05}
2025-03-02 15:52:34,815 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910950, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"d1tuY4cMEQipcLsLlx9qYggG5Jg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 4734, "operationId": 4734, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:34,915 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 99.898, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 4734, "operationId": 4734, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:34,915 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:34,915 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:34,916 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:34,916 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:34,916 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.230004899203777e-05}
2025-03-02 15:52:34,916 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 70, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910950, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"d1tuY4cMEQipcLsLlx9qYggG5Jg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 3.2, \"memory_percent\": 65.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:30.440352\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 53, "operationId": 53, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:35,062 - INFO - System logs collected
2025-03-02 15:52:35,064 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:52:35,138 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 222.434, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910955, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910955, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"rxIOZzFoal/PLTw1BAMVNz/t7V4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910955, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 53, "operationId": 53, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:35,138 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:35,139 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:35,139 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1116195179, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:35,139 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1116195179, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.36796468835045953>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2857288917499439>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.21798534505686507>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:35,139 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:35,139 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.91999851167202e-05}
2025-03-02 15:52:35,139 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 71, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910955, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"rxIOZzFoal/PLTw1BAMVNz/t7V4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:34.814921\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4316be0003d68174b009e\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:34.814936\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4316be0003d68174b009f\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:34.814938\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1999, "operationId": 1999, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:35,217 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 77.84299999999999, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910955, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910955, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"rxIOZzFoal/PLTw1BAMVNz/t7V4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910955, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1999, "operationId": 1999, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:35,217 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:35,217 - INFO - 5 alerts stored
2025-03-02 15:52:35,219 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:36,450 - INFO - System metrics collected
2025-03-02 15:52:36,639 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:52:37,299 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:38,545 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10006.546900025569, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910958, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910958, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:38,546 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:38,662 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10035.087199998088, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910958, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910958, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:38,663 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:38,663 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10025.934400036931, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"availabilityZone\": \"aps1-az3\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910958, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910958, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:38,663 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:38,692 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1370>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1370>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1370>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1370>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:52:40,062 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:52:40,065 - INFO - Security logs collected
2025-03-02 15:52:40,220 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:40,220 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,220 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,220 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00013109995052218437}
2025-03-02 15:52:40,221 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910958, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"rv55XEs/7eoe2pC8GhUzYqQoZSk=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 26418, "operationId": 26418, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,319 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 98.10900000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 26418, "operationId": 26418, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,319 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:40,319 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:40,319 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,319 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,319 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 4.9900030717253685e-05}
2025-03-02 15:52:40,320 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 72, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910958, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"rv55XEs/7eoe2pC8GhUzYqQoZSk=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 2.6, \"memory_percent\": 65.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:36.450586\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27938, "operationId": 27938, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,613 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 293.48400000000004, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910960, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910960, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"kz1+fZpmi+9bIdgZW/ArOWiI5kY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910960, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 27938, "operationId": 27938, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,613 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:40,613 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:40,614 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1946180915, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:40,614 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1946180915, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,614 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,614 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.19000056758523e-05}
2025-03-02 15:52:40,614 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 73, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910960, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"kz1+fZpmi+9bIdgZW/ArOWiI5kY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:40.220011\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43170e0003d68174b00a4\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:40.220027\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43170e0003d68174b00a5\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:40.220028\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6900, "operationId": 6900, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,696 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 81.863, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910960, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910960, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"kz1+fZpmi+9bIdgZW/ArOWiI5kY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910960, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6900, "operationId": 6900, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:40,696 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:40,696 - INFO - 5 alerts stored
2025-03-02 15:52:40,698 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:42,344 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:42,456 - INFO - System metrics collected
2025-03-02 15:52:43,693 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:52:45,064 - INFO - System logs collected
2025-03-02 15:52:45,066 - INFO - Security logs collected
2025-03-02 15:52:45,699 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:45,699 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:45,699 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:45,699 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 9.210000280290842e-05}
2025-03-02 15:52:45,699 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910960, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"kz1+fZpmi+9bIdgZW/ArOWiI5kY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 3788, "operationId": 3788, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:45,725 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:52:45,863 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 163.366, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 3788, "operationId": 3788, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:45,863 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:45,863 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:45,863 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:45,863 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:45,863 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.3299940191209316e-05}
2025-03-02 15:52:45,864 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 74, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910960, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"kz1+fZpmi+9bIdgZW/ArOWiI5kY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 3.0, \"memory_percent\": 64.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:42.456081\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18127, "operationId": 18127, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:46,164 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 300.933, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910966, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910966, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"4/HrHINy1wDyaBMEf/7z77eD6Lk=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910966, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18127, "operationId": 18127, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:46,165 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:46,165 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:46,165 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 941686221, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:46,165 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 941686221, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.3184225306702882>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.24529611339575302>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.19871257604593612>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:46,165 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:46,165 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.6200078688561916e-05}
2025-03-02 15:52:46,166 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 75, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910966, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"4/HrHINy1wDyaBMEf/7z77eD6Lk=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:45.698918\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43176e0003d68174b00aa\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:45.698935\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43176e0003d68174b00ab\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:45.698937\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 467, "operationId": 467, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:46,312 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 146.41000000000003, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910966, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910966, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"4/HrHINy1wDyaBMEf/7z77eD6Lk=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910966, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 467, "operationId": 467, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:46,312 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:46,312 - INFO - 5 alerts stored
2025-03-02 15:52:46,315 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:47,387 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:48,462 - INFO - System metrics collected
2025-03-02 15:52:48,562 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10016.520299948752, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910968, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910968, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:48,563 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:48,638 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9975.141400005668, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910968, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910968, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:48,638 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:48,650 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9986.999899963848, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910968, \"i\": 1}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910968, \"i\": 1}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:48,651 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:50,064 - INFO - System logs collected
2025-03-02 15:52:50,067 - INFO - Security logs collected
2025-03-02 15:52:50,726 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:52:51,316 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:51,316 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,316 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,316 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.010002784430981e-05}
2025-03-02 15:52:51,316 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910968, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"WAuDS+FCG/JxlhmkOQZd0VuCgM0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 3728, "operationId": 3728, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,426 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 109.69500000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 3728, "operationId": 3728, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,426 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:51,426 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:51,426 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,426 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,426 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.079992115497589e-05}
2025-03-02 15:52:51,427 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 76, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910968, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"WAuDS+FCG/JxlhmkOQZd0VuCgM0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 4.9, \"memory_percent\": 64.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:48.462091\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14893, "operationId": 14893, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,750 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 323.216, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910972, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910972, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"RMlN/lynVKw1kbhBaJjw6Z+gKko=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910972, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14893, "operationId": 14893, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,750 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:51,750 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:51,751 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1071895493, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:51,751 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1071895493, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,751 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,751 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.389994036406279e-05}
2025-03-02 15:52:51,751 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 77, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910972, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"RMlN/lynVKw1kbhBaJjw6Z+gKko=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:51.316016\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4317be0003d68174b00b0\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:51.316031\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4317be0003d68174b00b1\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:51.316032\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24648, "operationId": 24648, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,867 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 116.18900000000001, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910972, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910972, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"RMlN/lynVKw1kbhBaJjw6Z+gKko=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910972, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 24648, "operationId": 24648, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:51,868 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:51,868 - INFO - 5 alerts stored
2025-03-02 15:52:51,870 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:52,431 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:52,748 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:52:54,468 - INFO - System metrics collected
2025-03-02 15:52:55,066 - INFO - System logs collected
2025-03-02 15:52:55,069 - INFO - Security logs collected
2025-03-02 15:52:56,870 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:56,870 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:56,870 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:56,871 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.110003545880318e-05}
2025-03-02 15:52:56,871 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910972, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"RMlN/lynVKw1kbhBaJjw6Z+gKko=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 22483, "operationId": 22483, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:56,975 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 104.834, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 22483, "operationId": 22483, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:56,976 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:56,976 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:56,976 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:56,976 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:56,976 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 4.91999089717865e-05}
2025-03-02 15:52:56,976 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 78, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910972, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"RMlN/lynVKw1kbhBaJjw6Z+gKko=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 4.9, \"memory_percent\": 64.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:52:54.468218\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 17807, "operationId": 17807, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:57,276 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 299.361, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910977, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910977, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"nfqO8mlOE69FlS7JzQdRsnDekr4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910977, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 17807, "operationId": 17807, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:57,276 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:57,276 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:52:57,276 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1421295587, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:52:57,276 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1421295587, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2831853045222247>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21130769073416794>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.17914378082774743>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:57,277 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:57,277 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.489998824894428e-05}
2025-03-02 15:52:57,277 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 79, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910977, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"nfqO8mlOE69FlS7JzQdRsnDekr4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:56.870427\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43181e0003d68174b00b6\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:56.870443\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43181e0003d68174b00b7\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:52:56.870445\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 2421, "operationId": 2421, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:57,368 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 91.45100000000001, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910977, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910977, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"nfqO8mlOE69FlS7JzQdRsnDekr4=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910977, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 2421, "operationId": 2421, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:52:57,368 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:52:57,369 - INFO - 6 alerts stored
2025-03-02 15:52:57,371 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:52:57,476 - INFO - Processes monitored with VirusTotal
2025-03-02 15:52:57,750 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:52:58,556 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9992.787900031544, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910978, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910978, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:58,556 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:58,645 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10006.46029994823, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910978, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910978, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:58,645 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:58,687 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10035.934000043198, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910978, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:22:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910978, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:22:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:52:58,687 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:52:59,793 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327570>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:53:00,067 - INFO - System logs collected
2025-03-02 15:53:00,070 - INFO - Security logs collected
2025-03-02 15:53:00,476 - INFO - System metrics collected
2025-03-02 15:53:02,372 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:02,372 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,372 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,372 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.909997995942831e-05}
2025-03-02 15:53:02,373 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910978, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"lT7D5Z73LSQOqOAiDNYxCLriax0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 14310, "operationId": 14310, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,444 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 71.56800000000001, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 14310, "operationId": 14310, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,444 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:02,444 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:02,445 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,445 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,445 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.0200033001601696e-05}
2025-03-02 15:53:02,445 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 80, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910978, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"lT7D5Z73LSQOqOAiDNYxCLriax0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 5.4, \"memory_percent\": 65.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:00.476001\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6617, "operationId": 6617, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,522 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:02,745 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 299.834, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910983, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910983, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"3TIpS4VI4+P+UU+gUMujcoJd4Ow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910983, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6617, "operationId": 6617, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,745 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:02,745 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:02,746 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -631352055, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:02,746 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -631352055, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,746 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,746 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.570007488131523e-05}
2025-03-02 15:53:02,746 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 81, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910983, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"3TIpS4VI4+P+UU+gUMujcoJd4Ow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:02.372287\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43186e0003d68174b00bd\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:02.372302\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43186e0003d68174b00be\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:02.372304\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 22813, "operationId": 22813, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,837 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 90.7, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910983, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910983, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"3TIpS4VI4+P+UU+gUMujcoJd4Ow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910983, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 22813, "operationId": 22813, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:02,837 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:02,837 - INFO - 6 alerts stored
2025-03-02 15:53:02,839 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:04,794 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:53:05,068 - INFO - System logs collected
2025-03-02 15:53:05,071 - INFO - Security logs collected
2025-03-02 15:53:06,481 - INFO - System metrics collected
2025-03-02 15:53:06,833 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:53:07,567 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:07,840 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:07,840 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:07,840 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:07,841 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.289993274956942e-05}
2025-03-02 15:53:07,841 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910983, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"3TIpS4VI4+P+UU+gUMujcoJd4Ow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 9514, "operationId": 9514, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:07,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 83.892, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 9514, "operationId": 9514, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:07,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:07,925 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:07,925 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:07,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:07,925 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 4.880002234131098e-05}
2025-03-02 15:53:07,926 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 82, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910983, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"3TIpS4VI4+P+UU+gUMujcoJd4Ow=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 3.5, \"memory_percent\": 65.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:06.481778\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14309, "operationId": 14309, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:08,212 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 286.89599999999996, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"JmEocsnaJn9aZxcgQdS5mdgqngU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14309, "operationId": 14309, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:08,212 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:08,213 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:08,213 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -461268972, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:08,213 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -461268972, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2598563036193617>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18877275259635104>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16528542466684562>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:08,213 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:08,213 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.009999196976423e-05}
2025-03-02 15:53:08,213 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 83, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"JmEocsnaJn9aZxcgQdS5mdgqngU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:07.840331\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4318ce0003d68174b00c4\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:07.840356\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4318ce0003d68174b00c5\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:07.840357\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 7616, "operationId": 7616, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:08,304 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 90.21600000000001, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 7}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 7}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"JmEocsnaJn9aZxcgQdS5mdgqngU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 7}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 7616, "operationId": 7616, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:08,304 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:08,304 - INFO - 6 alerts stored
2025-03-02 15:53:08,306 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:08,587 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10030.589199974202, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 9}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 9}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:08,587 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:08,662 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10016.387199983, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 9}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 9}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:08,662 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:08,663 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9975.282000028528, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 9}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 9}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:08,663 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:10,069 - INFO - System logs collected
2025-03-02 15:53:10,073 - INFO - Security logs collected
2025-03-02 15:53:11,835 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:53:12,487 - INFO - System metrics collected
2025-03-02 15:53:12,612 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:13,307 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23399260287724527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1752017020764252>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1700853397277321>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:13,307 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23399260287724527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1752017020764252>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1700853397277321>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,307 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,307 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.660000119358301e-05}
2025-03-02 15:53:13,307 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 9}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"JmEocsnaJn9aZxcgQdS5mdgqngU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 18935, "operationId": 18935, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,395 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 87.90599999999999, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 18935, "operationId": 18935, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,395 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:13,395 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23399260287724527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1752017020764252>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1700853397277321>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:13,395 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23399260287724527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1752017020764252>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1700853397277321>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,396 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,396 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.380006041377783e-05}
2025-03-02 15:53:13,396 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 84, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910988, \"i\": 9}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"JmEocsnaJn9aZxcgQdS5mdgqngU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 3.9, \"memory_percent\": 64.9, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:12.487246\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 17451, "operationId": 17451, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,704 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 308.44899999999996, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910993, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910993, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"rqgPeFxuJbWCGXwN5hs751vD/Ok=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910993, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 17451, "operationId": 17451, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,704 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:13,705 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:13,705 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -227866167, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23399260287724527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1752017020764252>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1700853397277321>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:13,705 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -227866167, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.23399260287724527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1752017020764252>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1700853397277321>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,705 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,705 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.559999357908964e-05}
2025-03-02 15:53:13,705 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 85, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910993, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"rqgPeFxuJbWCGXwN5hs751vD/Ok=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:13.306876\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43191e0003d68174b00cb\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:13.306891\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43191e0003d68174b00cc\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:13.306893\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20600, "operationId": 20600, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,787 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 81.458, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910994, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910994, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"D+uzeFQd02tXclHnzAMZNOIurDc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910994, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20600, "operationId": 20600, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:13,787 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:13,787 - INFO - 5 alerts stored
2025-03-02 15:53:13,789 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:13,886 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:53:15,070 - INFO - System logs collected
2025-03-02 15:53:15,074 - INFO - Security logs collected
2025-03-02 15:53:17,657 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:18,492 - INFO - System metrics collected
2025-03-02 15:53:18,567 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9979.662199970335, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az1\", \"region\": \"AP_SOUTH_1\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910998, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910998, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:18,568 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:18,653 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9990.355200017802, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910998, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910998, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:18,654 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:18,712 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10049.073999980465, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910998, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910998, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:18,713 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:18,790 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:18,790 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:18,790 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:18,790 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.310005068778992e-05}
2025-03-02 15:53:18,790 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910998, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"N4/FolpP/QzYqYinFH0/4LWJueM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 5249, "operationId": 5249, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:18,887 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:53:18,899 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 109.095, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 5249, "operationId": 5249, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:18,900 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:18,900 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:18,900 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:18,900 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:18,900 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.999995093792677e-05}
2025-03-02 15:53:18,900 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 86, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910998, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"N4/FolpP/QzYqYinFH0/4LWJueM=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 2.8, \"memory_percent\": 65.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:18.492285\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16519, "operationId": 16519, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:19,237 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 337.18199999999996, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910999, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910999, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7hbKenETs+ulAE7rAVeMdgU/xZY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910999, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 16519, "operationId": 16519, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:19,238 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:19,238 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:19,238 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 2103116644, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:19,238 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 2103116644, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:19,238 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:19,238 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.40000619366765e-05}
2025-03-02 15:53:19,238 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 87, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910999, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7hbKenETs+ulAE7rAVeMdgU/xZY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:18.790024\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43197e0003d68174b00d1\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:18.790038\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c43197e0003d68174b00d2\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:18.790040\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 31556, "operationId": 31556, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:19,348 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 109.986, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740910999, \"i\": 4}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910999, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7hbKenETs+ulAE7rAVeMdgU/xZY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740910999, \"i\": 4}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 31556, "operationId": 31556, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:19,349 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:19,349 - INFO - 5 alerts stored
2025-03-02 15:53:19,351 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:20,072 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:53:20,075 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:53:20,928 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1260>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1260>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1260>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1260>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:53:22,699 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:24,352 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:24,352 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,352 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,352 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.889997843652964e-05}
2025-03-02 15:53:24,352 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910999, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7hbKenETs+ulAE7rAVeMdgU/xZY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 22798, "operationId": 22798, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,435 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 82.873, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 22798, "operationId": 22798, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,436 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:24,436 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:24,436 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,436 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,436 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.539995618164539e-05}
2025-03-02 15:53:24,436 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 88, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740910999, \"i\": 4}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"7hbKenETs+ulAE7rAVeMdgU/xZY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 2.8, \"memory_percent\": 65.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:18.492285\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 30303, "operationId": 30303, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,498 - INFO - System metrics collected
2025-03-02 15:53:24,712 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 275.65000000000003, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911004, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911004, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"VYl+R1kxXmq/FtTmCz6EuoePuQs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911004, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 30303, "operationId": 30303, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,712 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:24,712 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:24,712 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1550921536, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:24,713 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1550921536, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.2119137023088865>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16179984165295613>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.16006193177954461>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,713 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,713 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.8299978263676167e-05}
2025-03-02 15:53:24,713 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 89, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911004, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"VYl+R1kxXmq/FtTmCz6EuoePuQs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:24.352254\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4319ce0003d68174b00d7\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:24.352268\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c4319ce0003d68174b00d8\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:24.352271\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6224, "operationId": 6224, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,812 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 99.21199999999999, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911005, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911005, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"olzEG4DkZ4oRyBlzUPL8CnGVFeA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911005, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6224, "operationId": 6224, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:24,812 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:24,812 - INFO - 5 alerts stored
2025-03-02 15:53:24,814 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:25,073 - INFO - System logs collected
2025-03-02 15:53:25,076 - INFO - Security logs collected
2025-03-02 15:53:25,929 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:53:27,743 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:27,986 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D3279B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:53:28,612 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10044.148499961011, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911008, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911008, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:28,612 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:28,693 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10039.187200018205, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911008, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911008, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:28,693 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9980.19559995737, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911008, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:28Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911008, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:28Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:28,693 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:28,694 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:29,815 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:29,815 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:29,815 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:29,815 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.669996168464422e-05}
2025-03-02 15:53:29,815 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911008, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"svrKvYpr4ht92iMI/3CRsTi8Fnc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 11008, "operationId": 11008, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:29,894 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 79.033, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 11008, "operationId": 11008, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:29,895 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:29,895 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:29,895 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:29,895 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:29,895 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.5600074119865894e-05}
2025-03-02 15:53:29,895 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 90, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911008, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"svrKvYpr4ht92iMI/3CRsTi8Fnc=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 0.9, \"memory_percent\": 64.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:24.497961\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5844, "operationId": 5844, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:30,074 - INFO - System logs collected
2025-03-02 15:53:30,078 - INFO - Security logs collected
2025-03-02 15:53:30,195 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 300.132, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911010, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911010, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"O7GoAJ+7+F60vCpr7rGrutXZ6OU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911010, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 5844, "operationId": 5844, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:30,196 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:30,196 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:30,196 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 603609456, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:30,196 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 603609456, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:30,196 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:30,196 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.780005060136318e-05}
2025-03-02 15:53:30,196 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 91, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911010, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"O7GoAJ+7+F60vCpr7rGrutXZ6OU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:29.815240\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431a2e0003d68174b00dd\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:29.815253\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431a2e0003d68174b00de\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:29.815255\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 32609, "operationId": 32609, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:30,287 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 90.837, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911010, \"i\": 5}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911010, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"O7GoAJ+7+F60vCpr7rGrutXZ6OU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911010, \"i\": 5}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 32609, "operationId": 32609, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:30,288 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:30,288 - INFO - 5 alerts stored
2025-03-02 15:53:30,290 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:30,503 - INFO - System metrics collected
2025-03-02 15:53:32,785 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:32,987 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:53:35,036 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:53:35,075 - INFO - System logs collected
2025-03-02 15:53:35,079 - INFO - Security logs collected
2025-03-02 15:53:35,291 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:35,291 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,291 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,291 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.380005601793528e-05}
2025-03-02 15:53:35,291 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911010, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"O7GoAJ+7+F60vCpr7rGrutXZ6OU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 14989, "operationId": 14989, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,437 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 146.134, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 14989, "operationId": 14989, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,437 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:35,438 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:35,438 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,438 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,438 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.450006574392319e-05}
2025-03-02 15:53:35,438 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 92, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911010, \"i\": 5}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"O7GoAJ+7+F60vCpr7rGrutXZ6OU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.5, \"memory_percent\": 64.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:30.503155\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 32702, "operationId": 32702, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,695 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 257.55, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911015, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911015, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"dP7UvSNqybIKzMvmIJFerO5o2Vs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911015, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 32702, "operationId": 32702, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,696 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:35,696 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:35,696 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -999090832, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:35,696 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -999090832, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.203551821851348>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16727087330490822>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15565382541673767>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,696 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,696 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.089999806135893e-05}
2025-03-02 15:53:35,697 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 93, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911015, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"dP7UvSNqybIKzMvmIJFerO5o2Vs=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:35.290863\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431a7e0003d68174b00e3\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:35.290877\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431a7e0003d68174b00e4\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:35.290879\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3195, "operationId": 3195, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,842 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 145.21300000000002, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911016, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911016, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"Wevv54OiaNmrfOD0UVYHNJvPinY=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911016, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3195, "operationId": 3195, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:35,842 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:35,842 - INFO - 5 alerts stored
2025-03-02 15:53:35,844 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:36,508 - INFO - System metrics collected
2025-03-02 15:53:37,831 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:38,764 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10151.855900068767, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911018, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911018, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:38,765 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:38,766 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10072.21509993542, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911018, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911018, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:38,766 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:38,767 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10072.629599948414, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911018, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:38Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911018, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:38Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:38,767 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:40,037 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:53:40,076 - INFO - System logs collected
2025-03-02 15:53:40,080 - INFO - Security logs collected
2025-03-02 15:53:40,845 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:40,845 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:40,845 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:40,845 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 9.280000813305378e-05}
2025-03-02 15:53:40,846 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911018, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"CtCYQZFj2FKlwE/1dbpsTGCB0/Q=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 20485, "operationId": 20485, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:40,917 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 70.958, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 20485, "operationId": 20485, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:40,917 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:40,917 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:40,917 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:40,917 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:40,917 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.4299947805702686e-05}
2025-03-02 15:53:40,918 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 94, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911018, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"CtCYQZFj2FKlwE/1dbpsTGCB0/Q=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.2, \"memory_percent\": 64.8, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:36.508795\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3093, "operationId": 3093, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:41,090 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 172.47299999999998, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911021, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911021, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xqAnQs604dWJVgSPb/f/cDpxse0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911021, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 3093, "operationId": 3093, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:41,090 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:41,090 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:41,090 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -589950873, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:41,090 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -589950873, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:41,091 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:41,091 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.559995770454407e-05}
2025-03-02 15:53:41,091 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 95, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911021, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xqAnQs604dWJVgSPb/f/cDpxse0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:40.845359\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431ade0003d68174b00e9\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:40.845373\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431ade0003d68174b00ea\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:40.845374\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14343, "operationId": 14343, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:41,212 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 120.782, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911021, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911021, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xqAnQs604dWJVgSPb/f/cDpxse0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911021, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14343, "operationId": 14343, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:41,212 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:41,212 - INFO - 5 alerts stored
2025-03-02 15:53:41,214 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:42,075 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:53:42,514 - INFO - System metrics collected
2025-03-02 15:53:42,878 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:45,077 - INFO - System logs collected
2025-03-02 15:53:45,081 - INFO - Security logs collected
2025-03-02 15:53:46,214 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:46,214 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,215 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,215 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.200004231184721e-05}
2025-03-02 15:53:46,215 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911021, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xqAnQs604dWJVgSPb/f/cDpxse0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 30523, "operationId": 30523, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,324 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 109.388, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 30523, "operationId": 30523, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,324 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:46,324 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:46,325 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,325 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,325 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 4.900002386420965e-05}
2025-03-02 15:53:46,325 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 96, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911021, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xqAnQs604dWJVgSPb/f/cDpxse0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 2.5, \"memory_percent\": 64.9, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:42.514023\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1587, "operationId": 1587, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,774 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 449.377, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911027, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911027, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"G/cqYfGpd+3/3PZvEb4E/9KKRa0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911027, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 1587, "operationId": 1587, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,775 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:46,776 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:46,776 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1391247900, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:46,776 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -1391247900, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.21677323747757038>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1704729986457043>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14367616032942793>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,776 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,776 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.46000262349844e-05}
2025-03-02 15:53:46,776 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 97, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911027, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"G/cqYfGpd+3/3PZvEb4E/9KKRa0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:46.214533\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431b2e0003d68174b00ef\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:46.214547\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431b2e0003d68174b00f0\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:46.214548\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 29314, "operationId": 29314, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,862 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 85.828, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911027, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911027, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"G/cqYfGpd+3/3PZvEb4E/9KKRa0=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911027, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 29314, "operationId": 29314, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:46,862 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:46,862 - INFO - 5 alerts stored
2025-03-02 15:53:46,865 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:47,077 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:53:47,926 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:48,519 - INFO - System metrics collected
2025-03-02 15:53:48,590 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9825.121500063688, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"nodeType\": \"ELECTABLE\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911028, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911028, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:48,590 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:48,713 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9946.19899999816, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"region\": \"AP_SOUTH_1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911028, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911028, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:48,713 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:48,713 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9946.16060005501, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911028, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:48Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911028, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:48Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:48,714 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:49,116 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F1590>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:53:50,078 - INFO - System logs collected
2025-03-02 15:53:50,082 - INFO - Security logs collected
2025-03-02 15:53:51,865 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:51,866 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:51,866 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:51,866 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.680000271648169e-05}
2025-03-02 15:53:51,866 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911028, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"hlosysvgkm20Q/5pQuPLSZ4pn2A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 9503, "operationId": 9503, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:51,949 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 83.38, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 9503, "operationId": 9503, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:51,950 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:51,950 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:51,950 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:51,950 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:51,950 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.200004670768976e-05}
2025-03-02 15:53:51,951 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 98, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911028, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"hlosysvgkm20Q/5pQuPLSZ4pn2A=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 1.7, \"memory_percent\": 65.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:48.518981\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 7448, "operationId": 7448, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:52,241 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 290.12100000000004, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911032, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911032, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xkT0j0gGxoXknAw8FrWQsfLg4wo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911032, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 7448, "operationId": 7448, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:52,241 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:52,241 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:52,241 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 978656771, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:52,242 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 978656771, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:52,242 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:52,242 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.550003308802843e-05}
2025-03-02 15:53:52,242 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 99, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911032, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xkT0j0gGxoXknAw8FrWQsfLg4wo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:51.865634\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431b8e0003d68174b00f5\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:51.865647\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431b8e0003d68174b00f6\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:51.865649\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 25200, "operationId": 25200, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:52,318 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 75.989, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911032, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911032, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xkT0j0gGxoXknAw8FrWQsfLg4wo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911032, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 25200, "operationId": 25200, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:52,318 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:52,319 - INFO - 5 alerts stored
2025-03-02 15:53:52,321 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:52,971 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:54,117 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:53:54,524 - INFO - System metrics collected
2025-03-02 15:53:55,079 - INFO - System logs collected
2025-03-02 15:53:55,084 - INFO - Security logs collected
2025-03-02 15:53:56,152 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F0D10>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:53:57,321 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:57,322 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,322 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,322 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.579999510198832e-05}
2025-03-02 15:53:57,322 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911032, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xkT0j0gGxoXknAw8FrWQsfLg4wo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 13458, "operationId": 13458, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,419 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 97.539, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 13458, "operationId": 13458, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,420 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:57,420 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:57,420 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,420 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,420 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.440006498247385e-05}
2025-03-02 15:53:57,420 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 100, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911032, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"xkT0j0gGxoXknAw8FrWQsfLg4wo=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 2.9, \"memory_percent\": 65.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:53:54.523970\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6618, "operationId": 6618, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,674 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 253.56, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911037, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911037, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"jruwmMsHzlxxYYhh1a7APwPEkQI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911037, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6618, "operationId": 6618, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,674 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:57,674 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:53:57,674 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 834676938, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:53:57,675 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 834676938, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.19763178997472047>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.16025105890060817>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.15206058825454594>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,675 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,675 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.8699981309473515e-05}
2025-03-02 15:53:57,675 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 101, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911037, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"jruwmMsHzlxxYYhh1a7APwPEkQI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:57.321669\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431bde0003d68174b00fb\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:57.321683\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431bde0003d68174b00fc\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:53:57.321685\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20580, "operationId": 20580, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,800 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 124.748, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TttA4JPIxfzp/ZoPMle4xqiJWBA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20580, "operationId": 20580, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:53:57,800 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:53:57,800 - INFO - 5 alerts stored
2025-03-02 15:53:57,802 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:53:58,016 - INFO - Processes monitored with VirusTotal
2025-03-02 15:53:58,613 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10022.27389998734, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az1\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:58,614 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:58,687 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9973.87810004875, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\", \"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:58,688 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:53:58,709 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9995.74089993257, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"nodeType\": \"ELECTABLE\", \"availabilityZone\": \"aps1-az3\", \"diskState\": \"READY\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 3}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:23:58Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 3}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:23:58Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:53:58,710 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:54:00,080 - INFO - System logs collected
2025-03-02 15:54:00,085 - INFO - Security logs collected
2025-03-02 15:54:00,530 - INFO - System metrics collected
2025-03-02 15:54:01,153 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:54:02,802 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:02,802 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:02,802 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:02,802 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.009991142898798e-05}
2025-03-02 15:54:02,803 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TttA4JPIxfzp/ZoPMle4xqiJWBA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 19796, "operationId": 19796, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:02,916 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 113.208, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 19796, "operationId": 19796, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:02,916 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:02,916 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:02,916 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:02,916 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:02,916 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.519995465874672e-05}
2025-03-02 15:54:02,917 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 102, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911038, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"TttA4JPIxfzp/ZoPMle4xqiJWBA=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 8.0, \"memory_percent\": 65.2, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:54:00.530306\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14798, "operationId": 14798, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:03,062 - INFO - Processes monitored with VirusTotal
2025-03-02 15:54:03,200 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F06B0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:54:03,263 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 346.15299999999996, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911043, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911043, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"g92qgqSOpff+MzLrNWgm2zGn+2I=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911043, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 14798, "operationId": 14798, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:03,263 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:03,263 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:54:03,263 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 525272185, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:03,264 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 525272185, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:03,264 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:03,264 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 6.879994180053473e-05}
2025-03-02 15:54:03,264 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 103, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911043, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"g92qgqSOpff+MzLrNWgm2zGn+2I=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:02.802410\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431c3e0003d68174b0101\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:02.802423\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431c3e0003d68174b0102\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:02.802425\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15281, "operationId": 15281, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:03,357 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 92.78999999999999, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911043, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911043, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"g92qgqSOpff+MzLrNWgm2zGn+2I=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911043, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 15281, "operationId": 15281, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:03,357 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:03,357 - INFO - 5 alerts stored
2025-03-02 15:54:03,360 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:54:05,082 - INFO - System logs collected
2025-03-02 15:54:05,087 - INFO - Security logs collected
2025-03-02 15:54:06,536 - INFO - System metrics collected
2025-03-02 15:54:08,110 - INFO - Processes monitored with VirusTotal
2025-03-02 15:54:08,201 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:54:08,361 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:08,361 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,361 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,361 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.009991142898798e-05}
2025-03-02 15:54:08,361 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911043, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"g92qgqSOpff+MzLrNWgm2zGn+2I=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 19589, "operationId": 19589, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,512 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 150.71499999999997, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 19589, "operationId": 19589, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,512 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:08,512 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:08,512 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.18337239198691493>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1529171271254275>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.1449276906091341>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,513 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,513 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 4.900002386420965e-05}
2025-03-02 15:54:08,513 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 104, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911043, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"g92qgqSOpff+MzLrNWgm2zGn+2I=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 6.1, \"memory_percent\": 64.9, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:54:06.536058\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20798, "operationId": 20798, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,604 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9989.437900017947, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"provider\": \"AWS\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911048, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:24:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911048, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:24:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:54:08,604 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:54:08,688 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10000.39529998321, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"availabilityZone\": \"aps1-az2\", \"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911048, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:24:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911048, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:24:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:54:08,689 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:54:08,737 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10027.024799957871, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911048, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:24:08Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911048, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:24:08Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:54:08,737 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:54:08,756 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 243.181, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911049, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911049, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ID2qiwrF5dq8qaOe1QtCZg/ZEEE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911049, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20798, "operationId": 20798, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,756 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:08,756 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:54:08,757 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 590805725, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17367029359062988>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14944110170509398>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14369329248108664>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:08,757 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 590805725, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17367029359062988>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14944110170509398>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14369329248108664>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,757 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,757 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.630007945001125e-05}
2025-03-02 15:54:08,757 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 105, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911049, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ID2qiwrF5dq8qaOe1QtCZg/ZEEE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:08.361066\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431c8e0003d68174b0107\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:08.361081\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431c8e0003d68174b0108\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:08.361082\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 28009, "operationId": 28009, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,848 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 90.914, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911049, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911049, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ID2qiwrF5dq8qaOe1QtCZg/ZEEE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911049, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 28009, "operationId": 28009, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:08,848 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:08,848 - INFO - 6 alerts stored
2025-03-02 15:54:08,850 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:54:10,083 - ERROR - Error collecting system logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 183, in get_system_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:54:10,088 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:54:10,238 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327460>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:54:12,542 - INFO - System metrics collected
2025-03-02 15:54:13,155 - INFO - Processes monitored with VirusTotal
2025-03-02 15:54:13,851 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17367029359062988>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14944110170509398>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14369329248108664>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:13,851 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17367029359062988>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14944110170509398>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14369329248108664>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:13,852 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:13,852 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.200004231184721e-05}
2025-03-02 15:54:13,852 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911049, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ID2qiwrF5dq8qaOe1QtCZg/ZEEE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 27157, "operationId": 27157, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:13,930 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 77.918, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 27157, "operationId": 27157, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:13,930 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:13,930 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17367029359062988>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14944110170509398>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14369329248108664>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:13,930 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17367029359062988>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14944110170509398>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14369329248108664>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:13,930 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:13,930 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.570007488131523e-05}
2025-03-02 15:54:13,931 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 106, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911049, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"ID2qiwrF5dq8qaOe1QtCZg/ZEEE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 4.3, \"memory_percent\": 65.0, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:54:12.542076\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20472, "operationId": 20472, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:14,288 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 357.769, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911054, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911054, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DstGGGAbGLUlSVDyX7lxPlcpRi8=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911054, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 20472, "operationId": 20472, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:14,288 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:14,289 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:54:14,289 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1868413276, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17367029359062988>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14944110170509398>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14369329248108664>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:14,289 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1868413276, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.17367029359062988>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.14944110170509398>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.14369329248108664>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:14,289 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:14,289 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.710008554160595e-05}
2025-03-02 15:54:14,290 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 107, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911054, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DstGGGAbGLUlSVDyX7lxPlcpRi8=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:13.851541\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431cee0003d68174b010e\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:13.851555\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431cee0003d68174b010f\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:13.851556\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23622, "operationId": 23622, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:14,377 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 87.70899999999999, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911054, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911054, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"DstGGGAbGLUlSVDyX7lxPlcpRi8=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911054, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 23622, "operationId": 23622, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:14,378 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:14,378 - INFO - 6 alerts stored
2025-03-02 15:54:14,379 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:54:15,084 - INFO - System logs collected
2025-03-02 15:54:15,089 - INFO - Security logs collected
2025-03-02 15:54:15,239 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:54:17,302 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D326E00>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:54:18,199 - INFO - Processes monitored with VirusTotal
2025-03-02 15:54:18,547 - INFO - System metrics collected
2025-03-02 15:54:18,637 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10032.449300051667, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c3975e31d6e34d93ef096d\"}, \"counter\": 4}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"nodeType\": \"ELECTABLE\", \"provider\": \"AWS\", \"workloadType\": \"OPERATIONAL\", \"region\": \"AP_SOUTH_1\", \"availabilityZone\": \"aps1-az1\", \"diskState\": \"READY\"}, \"me\": \"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911058, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:24:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911058, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:24:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:54:18,637 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11771, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:54:18,713 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 10024.604800040834, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c398cf9d5a40fa90030e61\"}, \"counter\": 6}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"isWritablePrimary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"diskState\": \"READY\", \"workloadType\": \"OPERATIONAL\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az2\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911058, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:24:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911058, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:24:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSiz...", "message": "Server heartbeat succeeded"}
2025-03-02 15:54:18,714 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 12636, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:54:18,728 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 9990.19440007396, "reply": "{\"topologyVersion\": {\"processId\": {\"$oid\": \"67c399f31df80d3c8eac6e83\"}, \"counter\": 3}, \"hosts\": [\"zyrasiemcluster-shard-00-00.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\"], \"setName\": \"atlas-p190fa-shard-0\", \"setVersion\": 1, \"secondary\": true, \"primary\": \"zyrasiemcluster-shard-00-02.8ydms.mongodb.net:27017\", \"tags\": {\"region\": \"AP_SOUTH_1\", \"workloadType\": \"OPERATIONAL\", \"diskState\": \"READY\", \"provider\": \"AWS\", \"availabilityZone\": \"aps1-az3\", \"nodeType\": \"ELECTABLE\"}, \"me\": \"zyrasiemcluster-shard-00-01.8ydms.mongodb.net:27017\", \"lastWrite\": {\"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911058, \"i\": 2}}, \"t\": 85}, \"lastWriteDate\": {\"$date\": \"2025-03-02T10:24:18Z\"}, \"majorityOpTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911058, \"i\": 2}}, \"t\": 85}, \"majorityWriteDate\": {\"$date\": \"2025-03-02T10:24:18Z\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\":...", "message": "Server heartbeat succeeded"}
2025-03-02 15:54:18,728 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "driverConnectionId": 14, "serverConnectionId": 11302, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-03-02 15:54:19,380 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:19,380 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,380 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,380 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.880001794546843e-05}
2025-03-02 15:54:19,381 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911058, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"0m/5m20pftK5p6+Cj+k13oeuI4Q=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 18538, "operationId": 18538, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,477 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 96.917, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 18538, "operationId": 18538, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,482 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:19,483 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:19,483 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,483 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,483 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.1999930292367935e-05}
2025-03-02 15:54:19,483 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 108, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911058, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"0m/5m20pftK5p6+Cj+k13oeuI4Q=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 5.8, \"memory_percent\": 65.1, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:54:18.547581\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12292, "operationId": 12292, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,695 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 211.64600000000002, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911059, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911059, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"lb5zF1hmlM1ME1Bpnn36Z8RkGbQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911059, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 12292, "operationId": 12292, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,695 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:19,695 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:54:19,696 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -433562142, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:19,696 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -433562142, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,696 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,696 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 7.780001033097506e-05}
2025-03-02 15:54:19,696 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 109, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911059, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"lb5zF1hmlM1ME1Bpnn36Z8RkGbQ=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:19.380302\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431d3e0003d68174b0115\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:19.380316\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431d3e0003d68174b0116\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:19.380318\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6038, "operationId": 6038, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,797 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 100.73, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911060, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911060, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"SKcjxJih9TVJyVorWk06y0icHaU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911060, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6038, "operationId": 6038, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:19,797 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:19,797 - INFO - 6 alerts stored
2025-03-02 15:54:19,799 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:54:20,085 - INFO - System logs collected
2025-03-02 15:54:20,091 - INFO - Security logs collected
2025-03-02 15:54:22,303 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:54:23,245 - INFO - Processes monitored with VirusTotal
2025-03-02 15:54:24,334 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D327AC0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:54:24,553 - INFO - System metrics collected
2025-03-02 15:54:24,800 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:24,800 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:24,800 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:24,800 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.100003469735384e-05}
2025-03-02 15:54:24,801 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911060, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"SKcjxJih9TVJyVorWk06y0icHaU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 24179, "operationId": 24179, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:24,874 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 73.836, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 24179, "operationId": 24179, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:24,875 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:24,875 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:24,875 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:24,875 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:24,875 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 4.870002157986164e-05}
2025-03-02 15:54:24,875 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 110, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911060, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"SKcjxJih9TVJyVorWk06y0icHaU=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 6.5, \"memory_percent\": 65.4, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:54:24.553096\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18190, "operationId": 18190, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:25,086 - INFO - System logs collected
2025-03-02 15:54:25,092 - INFO - Security logs collected
2025-03-02 15:54:25,274 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 399.186, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911065, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911065, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"NVaOfvHXRsGidSOk6ODn5XASQTw=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911065, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 18190, "operationId": 18190, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:25,275 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:25,275 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:54:25,276 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -565981291, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:25,276 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": -565981291, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:25,276 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:25,276 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.0001118999207392335}
2025-03-02 15:54:25,276 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 111, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911065, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"NVaOfvHXRsGidSOk6ODn5XASQTw=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:24.800339\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431d9e0003d68174b011c\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:24.800352\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431d9e0003d68174b011d\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:24.800353\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 29657, "operationId": 29657, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:25,401 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 124.926, "reply": "{\"n\": 6, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911065, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911065, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"NVaOfvHXRsGidSOk6ODn5XASQTw=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911065, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 29657, "operationId": 29657, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:25,402 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:25,402 - INFO - 6 alerts stored
2025-03-02 15:54:25,403 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:54:28,290 - INFO - Processes monitored with VirusTotal
2025-03-02 15:54:29,335 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2025-03-02 15:54:30,087 - INFO - System logs collected
2025-03-02 15:54:30,094 - INFO - Security logs collected
2025-03-02 15:54:30,404 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:30,404 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,404 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,405 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 8.41999426484108e-05}
2025-03-02 15:54:30,405 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911065, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"NVaOfvHXRsGidSOk6ODn5XASQTw=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 7958, "operationId": 7958, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,508 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 103.724, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 7958, "operationId": 7958, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,509 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:30,509 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:30,509 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,509 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,509 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.7200086303055286e-05}
2025-03-02 15:54:30,509 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 112, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911065, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"NVaOfvHXRsGidSOk6ODn5XASQTw=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 6.5, \"memory_percent\": 65.4, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:54:24.553096\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6191, "operationId": 6191, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,557 - INFO - System metrics collected
2025-03-02 15:54:30,713 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 203.64499999999998, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911070, \"i\": 3}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911070, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"GbXYzcICwtXufMpmIG92T+TJgQg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911070, \"i\": 3}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 6191, "operationId": 6191, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,713 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:30,713 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:54:30,713 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1340169360, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:30,714 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1340169360, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,714 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,714 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.5999960750341415e-05}
2025-03-02 15:54:30,714 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 113, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911070, \"i\": 3}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"GbXYzcICwtXufMpmIG92T+TJgQg=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:30.404467\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431dee0003d68174b0123\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:30.404489\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431dee0003d68174b0124\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:30.404490\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19815, "operationId": 19815, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,818 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 103.809, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911071, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911071, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"jk48zy2HXY0bCW3HMLH/rHZH+LI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911071, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19815, "operationId": 19815, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:30,818 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:30,818 - INFO - 5 alerts stored
2025-03-02 15:54:30,820 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:54:31,374 - ERROR - Error handling API command: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 377, in handle_api_command
    response = requests.get(COMMAND_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /command (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000023E1D5F08D0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2025-03-02 15:54:33,343 - INFO - Processes monitored with VirusTotal
2025-03-02 15:54:35,088 - INFO - System logs collected
2025-03-02 15:54:35,095 - ERROR - Error collecting security logs: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 212, in get_security_logs\u5b9e\u65f6
    total_records = win32evtlog.GetNumberOfEventLogRecords(hand)
pywintypes.error: (6, 'GetNumberOfEventLogRecords', 'The handle is invalid.')

2025-03-02 15:54:35,821 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:35,822 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "ping", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:35,822 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:35,823 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00037329993210732937}
2025-03-02 15:54:35,823 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"ping\": 1, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911071, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"jk48zy2HXY0bCW3HMLH/rHZH+LI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"admin\"}", "commandName": "ping", "databaseName": "admin", "requestId": 22888, "operationId": 22888, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:35,948 - INFO - Agent stopped by user
2025-03-02 15:54:35,964 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 141.226, "reply": "{\"ok\": 1}", "commandName": "ping", "databaseName": "admin", "requestId": 22888, "operationId": 22888, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:35,965 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:35,965 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:35,965 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:35,965 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:35,965 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 0.00011849997099488974}
2025-03-02 15:54:35,966 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"logs\", \"ordered\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 114, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911071, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"jk48zy2HXY0bCW3HMLH/rHZH+LI=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"writeConcern\": {\"w\": \"majority\"}, \"$db\": \"zyra_siem\", \"documents\": [{\"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"timestamp\": \"2025-03-02T15:46:29.111376\", \"system_metrics\": {\"cpu_percent\": 3.1, \"memory_percent\": 65.4, \"disk_usage\": 77.5, \"timestamp\": \"2025-03-02T15:54:30.557908\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"hostname\": \"MSI\"}, \"security_logs\": [{\"event_id\": 4672, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:25\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4672, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-5-18\"}, {\"event_id\": 4624, \"time\": \"2025-03-02 15:51:09\", \"desc\": \"S-1-...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19156, "operationId": 19156, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:36,188 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 222.246, "reply": "{\"n\": 1, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911076, \"i\": 1}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911076, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"16G7cSxSGjsrztcIdvnz6lkaTVE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911076, \"i\": 1}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 19156, "operationId": 19156, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:36,189 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:36,189 - INFO - Log stored for agent cbfe23ee-1591-46db-ad4a-773a5a9d1eb7
2025-03-02 15:54:36,190 - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1199029138, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}}
2025-03-02 15:54:36,191 - DEBUG - {"message": "Server selection succeeded", "selector": "<function writable_server_selector at 0x0000023E1CD5A160>", "operation": "insert", "operationId": 1199029138, "topologyDescription": "<TopologyDescription id: 67c42ff9e0003d68174affa0, topology_type: ReplicaSetWithPrimary, servers: [<ServerDescription ('zyrasiemcluster-shard-00-00.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.15830295486533527>, <ServerDescription ('zyrasiemcluster-shard-00-01.8ydms.mongodb.net', 27017) server_type: RSSecondary, rtt: 0.1398093613798895>, <ServerDescription ('zyrasiemcluster-shard-00-02.8ydms.mongodb.net', 27017) server_type: RSPrimary, rtt: 0.13172831400033644>]>", "clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:36,191 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checkout started", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:36,191 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked out", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2, "durationMS": 5.509995389729738e-05}
2025-03-02 15:54:36,191 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command started", "command": "{\"insert\": \"alerts\", \"ordered\": true, \"writeConcern\": {\"w\": \"majority\"}, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"kwMyvD+CSouq4S4VxPdX9Q==\", \"subType\": \"04\"}}}, \"txnNumber\": 115, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911076, \"i\": 1}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"16G7cSxSGjsrztcIdvnz6lkaTVE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"$db\": \"zyra_siem\", \"documents\": [{\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:35.820884\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431e4e0003d68174b0129\"}}, {\"type\": \"User Login\", \"severity\": \"Low\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:35.820924\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb7\", \"_id\": {\"$oid\": \"67c431e4e0003d68174b012a\"}}, {\"type\": \"Privilege Change\", \"severity\": \"Medium\", \"details\": \"S-1-5-18\", \"timestamp\": \"2025-03-02T15:54:35.820932\", \"agent_id\": \"cbfe23ee-1591-46db-ad4a-773a5a9d1eb...", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11511, "operationId": 11511, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:36,278 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Command succeeded", "durationMS": 87.28, "reply": "{\"n\": 5, \"electionId\": {\"$oid\": \"7fffffff0000000000000055\"}, \"opTime\": {\"ts\": {\"$timestamp\": {\"t\": 1740911076, \"i\": 2}}, \"t\": 85}, \"ok\": 1.0, \"$clusterTime\": {\"clusterTime\": {\"$timestamp\": {\"t\": 1740911076, \"i\": 2}}, \"signature\": {\"hash\": {\"$binary\": {\"base64\": \"16G7cSxSGjsrztcIdvnz6lkaTVE=\", \"subType\": \"00\"}}, \"keyId\": 7438264018092949505}}, \"operationTime\": {\"$timestamp\": {\"t\": 1740911076, \"i\": 2}}}", "commandName": "insert", "databaseName": "zyra_siem", "requestId": 11511, "operationId": 11511, "driverConnectionId": 2, "serverConnectionId": 12561, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017}
2025-03-02 15:54:36,279 - DEBUG - {"clientId": {"$oid": "67c42ff9e0003d68174affa0"}, "message": "Connection checked in", "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "driverConnectionId": 2}
2025-03-02 15:54:36,279 - INFO - 5 alerts stored
2025-03-02 15:54:36,286 - ERROR - Error syncing local data from alerts: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping
Traceback (most recent call last):
  File "C:\Users\adnan\OneDrive\Desktop\ZyraSIEM\agent.py", line 452, in sync_local_data
    collection.insert_many(local_data)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 974, in insert_many
    blk.ops = list(gen())
              ~~~~^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\collection.py", line 965, in gen
    common.validate_is_document_type("document", document)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\common.py", line 557, in validate_is_document_type
    raise TypeError(
    ...<4 lines>...
    )
TypeError: document must be an instance of dict, bson.son.SON, bson.raw_bson.RawBSONDocument, or a type that inherits from collections.MutableMapping

2025-03-02 15:54:36,562 - INFO - System metrics collected
2025-03-02 15:54:41,024 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-00.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 22387.007700046524, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 14, "message": "Server heartbeat failed"}
2025-03-02 15:54:41,071 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-02.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 22357.25569992792, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 14, "message": "Server heartbeat failed"}
2025-03-02 15:54:41,071 - DEBUG - {"topologyId": {"$oid": "67c42ff9e0003d68174affa0"}, "serverHost": "zyrasiemcluster-shard-00-01.8ydms.mongodb.net", "serverPort": 27017, "awaited": true, "durationMS": 22343.269600067288, "failure": "\"_OperationCancelled('operation cancelled')\"", "driverConnectionId": 14, "message": "Server heartbeat failed"}
2026-02-16 20:13:29,806 - INFO - Elevating to Administrator privileges...
2026-02-16 20:13:35,657 - ERROR - Failed to connect to MongoDB: The DNS query name does not exist: _mongodb._tcp.zyrasiemcluster.8ydms.mongodb.net.
Traceback (most recent call last):
  File "C:\xampp1\htdocs\ZyraSIEM\agent.py", line 79, in initialize_mongo
    mongo_client = MongoClient(MONGO_URI, serverSelectionTimeoutMS=10000)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\mongo_client.py", line 784, in __init__
    res = uri_parser.parse_uri(
        entity,
    ...<6 lines>...
        srv_max_hosts=srv_max_hosts,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\uri_parser.py", line 558, in parse_uri
    nodes = dns_resolver.get_hosts()
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\srv_resolver.py", line 141, in get_hosts
    _, nodes = self._get_srv_response_and_hosts(True)
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\srv_resolver.py", line 120, in _get_srv_response_and_hosts
    results = self._resolve_uri(encapsulate_errors)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\srv_resolver.py", line 114, in _resolve_uri
    raise ConfigurationError(str(exc)) from None
pymongo.errors.ConfigurationError: The DNS query name does not exist: _mongodb._tcp.zyrasiemcluster.8ydms.mongodb.net.

2026-02-16 20:13:35,673 - INFO - Local SQLite database initialized
2026-02-16 20:13:35,674 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2026-02-16 20:13:37,864 - ERROR - Error fetching VT API key: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /get_vt_api_key (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001C9ECE816A0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x000001C9ECE816A0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /get_vt_api_key (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001C9ECE816A0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\xampp1\htdocs\ZyraSIEM\agent.py", line 118, in fetch_vt_api_key
    response = requests.get(VT_API_KEY_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='your-api-endpoint.localhost', port=5000): Max retries exceeded with url: /get_vt_api_key (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001C9ECE816A0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2026-02-16 20:13:37,869 - INFO - Data stored locally in logs
2026-02-16 20:13:37,912 - INFO - Registry change detected: SOFTWARE\Microsoft\Windows\CurrentVersion\Run
2026-02-16 20:13:37,927 - INFO - System logs collected
2026-02-16 20:13:37,932 - INFO - Processes monitored with VirusTotal
2026-02-16 20:13:37,932 - INFO - Security logs collected
2026-02-16 20:13:37,933 - WARNING - No internet/MongoDB connection. Storing locally.
2026-02-16 20:13:37,934 - DEBUG - Starting new HTTP connection (1): your-api-endpoint.localhost:5000
2026-02-16 20:13:37,939 - INFO - Data stored locally in logs
2026-02-16 20:13:37,944 - INFO - Data stored locally in alerts
2026-02-16 20:15:06,402 - INFO - Elevating to Administrator privileges...
2026-02-16 20:15:11,489 - ERROR - Failed to connect to MongoDB: The DNS query name does not exist: _mongodb._tcp.zyrasiemcluster.8ydms.mongodb.net.
Traceback (most recent call last):
  File "C:\xampp1\htdocs\ZyraSIEM\agent.py", line 79, in initialize_mongo
    mongo_client = MongoClient(MONGO_URI, serverSelectionTimeoutMS=10000)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\synchronous\mongo_client.py", line 784, in __init__
    res = uri_parser.parse_uri(
        entity,
    ...<6 lines>...
        srv_max_hosts=srv_max_hosts,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\uri_parser.py", line 558, in parse_uri
    nodes = dns_resolver.get_hosts()
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\srv_resolver.py", line 141, in get_hosts
    _, nodes = self._get_srv_response_and_hosts(True)
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\srv_resolver.py", line 120, in _get_srv_response_and_hosts
    results = self._resolve_uri(encapsulate_errors)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\pymongo\srv_resolver.py", line 114, in _resolve_uri
    raise ConfigurationError(str(exc)) from None
pymongo.errors.ConfigurationError: The DNS query name does not exist: _mongodb._tcp.zyrasiemcluster.8ydms.mongodb.net.

2026-02-16 20:15:11,490 - INFO - Local SQLite database initialized
2026-02-16 20:15:11,491 - DEBUG - Starting new HTTP connection (1): localhost:5000
2026-02-16 20:15:15,596 - ERROR - Error fetching VT API key: HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /get_vt_api_key (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001DA295456A0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))
Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
        (self._dns_host, self.port),
    ...<2 lines>...
        socket_options=self.socket_options,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    ~~~~~~~~~~~~^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 493, in _make_request
    conn.request(
    ~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<6 lines>...
        enforce_content_length=enforce_content_length,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 445, in request
    self.endheaders()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
    ~~~~~~~~~^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
    ~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 276, in connect
    self.sock = self._new_conn()
                ~~~~~~~~~~~~~~^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 213, in _new_conn
    raise NewConnectionError(
        self, f"Failed to establish a new connection: {e}"
    ) from e
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x000001DA295456A0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /get_vt_api_key (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001DA295456A0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\xampp1\htdocs\ZyraSIEM\agent.py", line 118, in fetch_vt_api_key
    response = requests.get(VT_API_KEY_URL, timeout=5)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\adnan\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /get_vt_api_key (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001DA295456A0>: Failed to establish a new connection: [WinError 10061] No connection could be made because the target machine actively refused it'))

2026-02-16 20:15:15,601 - INFO - Data stored locally in logs
2026-02-16 20:15:15,622 - INFO - System logs collected
2026-02-16 20:15:15,652 - INFO - Processes monitored with VirusTotal
2026-02-16 20:15:15,653 - INFO - Registry change detected: SOFTWARE\Microsoft\Windows\CurrentVersion\Run
2026-02-16 20:15:15,653 - INFO - Security logs collected
2026-02-16 20:15:15,654 - WARNING - No internet/MongoDB connection. Storing locally.
2026-02-16 20:15:15,655 - DEBUG - Starting new HTTP connection (1): localhost:5000
2026-02-16 20:15:15,660 - INFO - Data stored locally in logs
2026-02-16 20:15:15,665 - INFO - Data stored locally in alerts
2026-02-16 20:15:16,602 - INFO - System metrics collected
